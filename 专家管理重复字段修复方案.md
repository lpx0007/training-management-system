# 专家管理页面重复简历字段修复方案

## 🔍 问题确认

在 `src/pages/ExpertManagement.tsx` 的"添加专家"模态框中，存在**两个简历上传字段**：

### 第一个字段（正确）- 行1000-1017
```typescript
<div>
  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
    简历
  </label>
  {formData.resume ? (
    <a href={formData.resume} target="_blank" rel="noreferrer" className="text-blue-600 dark:text-blue-400 underline break-all mb-2 inline-block">已上传文件</a>
  ) : (
    <p className="text-sm text-gray-500 dark:text-gray-400 mb-2">未上传</p>
  )}
  <PermissionGuard permission="expert_add">
    <input
      type="file"
      accept="application/pdf,.doc,.docx,image/*"
      onChange={(e) => setAddResumeFile(e.target.files?.[0] || null)}
      className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500"
    />
  </PermissionGuard>
</div>
```

### 第二个字段（重复，需要删除）- 行1149-1169
```typescript
<div>
  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
    简历
  </label>
  {formData.resume ? (
    <a href={formData.resume} target="_blank" rel="noreferrer" className="text-blue-600 dark:text-blue-400 underline break-all mb-2 inline-block">查看当前简历</a>
  ) : (
    <p className="text-sm text-gray-500 dark:text-gray-400 mb-2">未上传简历</p>
  )}
  <PermissionGuard permission="expert_edit">  {/* ❌ 错误权限 */}
    <input
      type="file"
      accept="application/pdf,.doc,.docx,image/*"
      onChange={(e) => setEditResumeFile(e.target.files?.[0] || null)}  {/* ❌ 错误处理器 */}
      className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 file:mr-3 file:py-1 file:px-3 file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900/20 dark:file:text-blue-400"
    />
    {editResumeFile && (
      <p className="text-sm text-green-600 dark:text-green-400 mt-1">已选择: {editResumeFile.name}</p>
    )}
  </PermissionGuard>
</div>
```

## 🛠️ 修复步骤

### 手动修复方法：

1. **打开文件**: `src/pages/ExpertManagement.tsx`

2. **定位到第1149行**，找到第二个简历字段

3. **删除整个第二个简历字段div**（行1149-1169）

4. **保留第一个简历字段**（行1000-1017）

### 使用sed命令修复：

```bash
# 备份原文件
cp src/pages/ExpertManagement.tsx src/pages/ExpertManagement.tsx.backup

# 删除重复的简历字段（第二个）
sed -i '/查看当前简历/,/PermissionGuard>/d' src/pages/ExpertManagement.tsx
```

## 🗄️ 数据库检查

运行检查脚本确认数据库结构：
```bash
# 执行数据库检查
psql -f scripts/check-expert-resume-fields.sql
```

## ✅ 验证步骤

修复后验证：

1. **功能测试**:
   - 打开专家管理页面
   - 点击"添加专家"
   - 确认只有一个简历上传字段
   - 测试简历文件上传功能

2. **权限测试**:
   - 确认使用 `expert_add` 权限
   - 确认使用 `setAddResumeFile` 处理器

3. **UI测试**:
   - 确认界面布局正常
   - 确认没有重复的字段显示

## 📊 问题影响

- **UI问题**: 用户界面显示两个相同的简历上传字段
- **功能冲突**: 错误的权限和处理器可能导致上传失败
- **用户体验**: 混淆用户，不知道使用哪个字段

## 🎯 预期结果

修复后应该：
- ✅ 只显示一个简历上传字段
- ✅ 使用正确的权限 (`expert_add`)
- ✅ 使用正确的处理器 (`setAddResumeFile`)
- ✅ 界面简洁，用户体验良好
