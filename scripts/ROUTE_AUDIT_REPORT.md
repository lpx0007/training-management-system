# è·¯ç”±æ˜ å°„å®Œæ•´å®¡è®¡æŠ¥å‘Š

## æ‰§è¡Œæ—¶é—´
2025-01-XX

## å®¡è®¡ç›®çš„
å…¨é¢æ ¸å®æ‰€æœ‰åŠŸèƒ½é¢æ¿è·¯å¾„ä¸å®é™…è·¯ç”±é…ç½®çš„åŒ¹é…æƒ…å†µï¼Œç¡®ä¿ç”¨æˆ·æƒé™è°ƒæ•´åèƒ½å¤Ÿæ­£å¸¸è®¿é—®å¯¹åº”é¡µé¢ã€‚

## å®¡è®¡ç»“æœæ€»è§ˆ

| çŠ¶æ€ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| âœ… å®Œå…¨åŒ¹é… | 9 | è·¯å¾„å’Œæƒé™éƒ½æ­£ç¡®é…ç½® |
| âš ï¸ æƒé™ä¸åŒ¹é… | 2 | è·¯å¾„åŒ¹é…ä½†æƒé™é…ç½®éœ€è¦è°ƒæ•´ |
| âŒ æœªå®ç° | 1 | åŠŸèƒ½é¢æ¿å·²å®šä¹‰ä½†è·¯ç”±æœªé…ç½® |
| **æ€»è®¡** | **12** | æ‰€æœ‰åŠŸèƒ½é¢æ¿ |

## è¯¦ç»†å®¡è®¡ç»“æœ

### 1. dashboard (ä»ªè¡¨ç›˜)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/dashboard`
- **å®é™…è·¯ç”±**: `/dashboard` âœ…
- **æƒé™è¦æ±‚**: æ— ï¼ˆæ‰€æœ‰è§’è‰²å¯è®¿é—®ï¼‰
- **è·¯ç”±é…ç½®**: `<ProtectedRoute>` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 2. customer_management (å®¢æˆ·ç®¡ç†)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/customer-management`
- **å®é™…è·¯ç”±**: `/customer-management` âœ…
- **æƒé™è¦æ±‚**: `customer_view`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin', 'salesperson']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 3. training_management (åŸ¹è®­è®¡åˆ’)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/training-management`
- **å®é™…è·¯ç”±**: `/training-management` âœ…
- **æƒé™è¦æ±‚**: `training_view`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin', 'salesperson', 'expert']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…
- **å¤‡æ³¨**: å·²ä¿®å¤ï¼ŒåŒæ—¶ä¿ç•™ `/training-performance` å…¼å®¹è·¯å¾„

### 4. expert_management (ä¸“å®¶ç®¡ç†)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/expert-management`
- **å®é™…è·¯ç”±**: `/expert-management` âœ…
- **æƒé™è¦æ±‚**: `expert_view`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âš ï¸
- **çŠ¶æ€**: âš ï¸ **æƒé™é…ç½®è¿‡ä¸¥**
- **é—®é¢˜**: ä¸šåŠ¡å‘˜å’Œä¸“å®¶æœ‰ `expert_view` æƒé™ï¼Œä½†è·¯ç”±åªå…è®¸ç®¡ç†å‘˜è®¿é—®
- **å»ºè®®**: ä¿®æ”¹ä¸º `requiredRole={['admin', 'salesperson', 'expert']}`

### 5. salesperson_management (ä¸šåŠ¡å‘˜ç®¡ç†)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/salesperson-management`
- **å®é™…è·¯ç”±**: `/salesperson-management` âœ…
- **æƒé™è¦æ±‚**: `salesperson_view`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 6. prospectus_management (æ‹›å•†ç®€ç« )
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/prospectus-management`
- **å®é™…è·¯ç”±**: `/prospectus-management` âœ…
- **æƒé™è¦æ±‚**: `prospectus_view`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âš ï¸
- **çŠ¶æ€**: âš ï¸ **æƒé™é…ç½®è¿‡ä¸¥**
- **é—®é¢˜**: ä¸šåŠ¡å‘˜å’Œä¸“å®¶æœ‰ `prospectus_view` æƒé™ï¼Œä½†è·¯ç”±åªå…è®¸ç®¡ç†å‘˜è®¿é—®
- **å»ºè®®**: ä¿®æ”¹ä¸º `requiredRole={['admin', 'salesperson', 'expert']}`

### 7. poster_generator (æµ·æŠ¥ç”Ÿæˆ)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/poster-generator`
- **å®é™…è·¯ç”±**: `/poster-generator` âœ…
- **æƒé™è¦æ±‚**: `poster_generate`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…
- **å¤‡æ³¨**: ç›®å‰åªæœ‰ç®¡ç†å‘˜æœ‰ `poster_generate` æƒé™

### 8. data_management (æ•°æ®ç®¡ç†)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/data-management`
- **å®é™…è·¯ç”±**: `/data-management` âœ…
- **æƒé™è¦æ±‚**: `data_import` æˆ– `data_export`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 9. sales_tracking (é”€å”®è¿½è¸ª)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/sales-tracking`
- **å®é™…è·¯ç”±**: `/sales-tracking` âœ…
- **æƒé™è¦æ±‚**: `salesperson_view_performance`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 10. permission_management (æƒé™ç®¡ç†)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/permission-management`
- **å®é™…è·¯ç”±**: `/permission-management` âœ…
- **æƒé™è¦æ±‚**: `permission_manage`
- **è·¯ç”±é…ç½®**: `requiredRole={['admin']}` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

### 11. audit_logs (å®¡è®¡æ—¥å¿—)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/audit-logs`
- **å®é™…è·¯ç”±**: âŒ **æœªé…ç½®**
- **æƒé™è¦æ±‚**: `audit_log_view`
- **è·¯ç”±é…ç½®**: ä¸å­˜åœ¨
- **çŠ¶æ€**: âŒ **æœªå®ç°**
- **å½±å“**: ç”¨æˆ·å³ä½¿æœ‰æƒé™ä¹Ÿæ— æ³•è®¿é—®
- **å»ºè®®**: åˆ›å»º AuditLogs ç»„ä»¶å¹¶é…ç½®è·¯ç”±

### 12. profile_settings (ä¸ªäººè®¾ç½®)
- **åŠŸèƒ½é¢æ¿è·¯å¾„**: `/profile-settings`
- **å®é™…è·¯ç”±**: `/profile-settings` âœ…
- **æƒé™è¦æ±‚**: æ— ï¼ˆæ‰€æœ‰è§’è‰²å¯è®¿é—®ï¼‰
- **è·¯ç”±é…ç½®**: `<ProtectedRoute>` âœ…
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

## éœ€è¦ä¿®å¤çš„é—®é¢˜

### ğŸ”´ é«˜ä¼˜å…ˆçº§

#### é—®é¢˜ 1: expert_management è·¯ç”±æƒé™è¿‡ä¸¥
**å½±å“**: ä¸šåŠ¡å‘˜å’Œä¸“å®¶æ— æ³•è®¿é—®ä¸“å®¶ç®¡ç†é¡µé¢ï¼Œå³ä½¿ä»–ä»¬æœ‰ `expert_view` æƒé™

**å½“å‰é…ç½®**:
```typescript
<Route path="/expert-management" element={
  <ProtectedRoute requiredRole={['admin']}>
    <ExpertManagement />
  </ProtectedRoute>
} />
```

**å»ºè®®ä¿®æ”¹ä¸º**:
```typescript
<Route path="/expert-management" element={
  <ProtectedRoute requiredRole={['admin', 'salesperson', 'expert']}>
    <ExpertManagement />
  </ProtectedRoute>
} />
```

**ç†ç”±**:
- ä¸šåŠ¡å‘˜é»˜è®¤æœ‰ `expert_view` æƒé™ï¼Œéœ€è¦æŸ¥çœ‹ä¸“å®¶ä¿¡æ¯
- ä¸“å®¶éœ€è¦æŸ¥çœ‹å’Œç¼–è¾‘è‡ªå·±çš„èµ„æ–™ï¼ˆ`expert_profile_edit` æƒé™ï¼‰

#### é—®é¢˜ 2: prospectus_management è·¯ç”±æƒé™è¿‡ä¸¥
**å½±å“**: ä¸šåŠ¡å‘˜å’Œä¸“å®¶æ— æ³•è®¿é—®æ‹›å•†ç®€ç« é¡µé¢ï¼Œå³ä½¿ä»–ä»¬æœ‰ `prospectus_view` æƒé™

**å½“å‰é…ç½®**:
```typescript
<Route path="/prospectus-management" element={
  <ProtectedRoute requiredRole={['admin']}>
    <ProspectusManagement />
  </ProtectedRoute>
} />
```

**å»ºè®®ä¿®æ”¹ä¸º**:
```typescript
<Route path="/prospectus-management" element={
  <ProtectedRoute requiredRole={['admin', 'salesperson', 'expert']}>
    <ProspectusManagement />
  </ProtectedRoute>
} />
```

**ç†ç”±**:
- ä¸šåŠ¡å‘˜é»˜è®¤æœ‰ `prospectus_view` å’Œ `prospectus_download` æƒé™
- ä¸“å®¶é»˜è®¤æœ‰ `prospectus_view` æƒé™
- è¿™äº›è§’è‰²éœ€è¦æŸ¥çœ‹å’Œä¸‹è½½æ‹›å•†ç®€ç« 

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### é—®é¢˜ 3: audit_logs åŠŸèƒ½æœªå®ç°
**å½±å“**: åŠŸèƒ½é¢æ¿å·²å®šä¹‰ï¼Œä½†å®é™…é¡µé¢ä¸å­˜åœ¨

**å»ºè®®**:
1. åˆ›å»º `src/pages/AuditLogs.tsx` ç»„ä»¶
2. æ·»åŠ è·¯ç”±é…ç½®ï¼š
```typescript
<Route path="/audit-logs" element={
  <ProtectedRoute requiredRole={['admin']}>
    <AuditLogs />
  </ProtectedRoute>
} />
```

**ä¼˜å…ˆçº§**: ä¸­ï¼ˆç›®å‰åªæœ‰ç®¡ç†å‘˜æœ‰æ­¤æƒé™ï¼Œå½±å“èŒƒå›´å°ï¼‰

## æƒé™ç³»ç»Ÿè®¾è®¡å»ºè®®

### å½“å‰é—®é¢˜
è·¯ç”±ä½¿ç”¨ `requiredRole` è¿›è¡Œè§’è‰²çº§åˆ«çš„è®¿é—®æ§åˆ¶ï¼Œä½†è¿™ä¸ç»†ç²’åº¦çš„æƒé™ç³»ç»Ÿä¸å®Œå…¨åŒ¹é…ã€‚

### å»ºè®®æ”¹è¿›
1. **çŸ­æœŸæ–¹æ¡ˆ**: è°ƒæ•´è·¯ç”±çš„ `requiredRole` é…ç½®ï¼Œä½¿å…¶ä¸åŠŸèƒ½é¢æ¿çš„æƒé™è¦æ±‚ä¸€è‡´
2. **é•¿æœŸæ–¹æ¡ˆ**: åˆ›å»ºåŸºäºæƒé™çš„è·¯ç”±å®ˆå«ï¼Œè€Œä¸æ˜¯åŸºäºè§’è‰²

**ç¤ºä¾‹ - åŸºäºæƒé™çš„è·¯ç”±å®ˆå«**:
```typescript
<Route path="/expert-management" element={
  <PermissionRoute requiredPermission="expert_view">
    <ExpertManagement />
  </PermissionRoute>
} />
```

è¿™æ ·å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶è®¿é—®ï¼Œä¸æƒé™ç³»ç»Ÿå®Œå…¨ä¸€è‡´ã€‚

## éªŒè¯æ¸…å•

ä¿®å¤åï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š

### 1. ä¸šåŠ¡å‘˜æµ‹è¯•
- [ ] ç™»å½•ä¸šåŠ¡å‘˜è´¦å·
- [ ] æ£€æŸ¥ä¾§è¾¹æ æ˜¾ç¤ºï¼šä»ªè¡¨ç›˜ã€å®¢æˆ·ç®¡ç†ã€åŸ¹è®­è®¡åˆ’ã€ä¸“å®¶ç®¡ç†ã€æ‹›å•†ç®€ç« ã€ä¸ªäººè®¾ç½®
- [ ] ç‚¹å‡»æ¯ä¸ªèœå•é¡¹ï¼Œç¡®è®¤èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- [ ] ç‰¹åˆ«æµ‹è¯•ï¼šä¸“å®¶ç®¡ç†ã€æ‹›å•†ç®€ç« ï¼ˆä¹‹å‰æ— æ³•è®¿é—®ï¼‰

### 2. ä¸“å®¶æµ‹è¯•
- [ ] ç™»å½•ä¸“å®¶è´¦å·
- [ ] æ£€æŸ¥ä¾§è¾¹æ æ˜¾ç¤ºï¼šä»ªè¡¨ç›˜ã€åŸ¹è®­è®¡åˆ’ã€ä¸“å®¶ç®¡ç†ã€æ‹›å•†ç®€ç« ã€ä¸ªäººè®¾ç½®
- [ ] ç‚¹å‡»æ¯ä¸ªèœå•é¡¹ï¼Œç¡®è®¤èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- [ ] ç‰¹åˆ«æµ‹è¯•ï¼šä¸“å®¶ç®¡ç†ã€æ‹›å•†ç®€ç« ï¼ˆä¹‹å‰æ— æ³•è®¿é—®ï¼‰

### 3. ç®¡ç†å‘˜æµ‹è¯•
- [ ] ç™»å½•ç®¡ç†å‘˜è´¦å·
- [ ] æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½é¢æ¿éƒ½æ˜¾ç¤º
- [ ] éšæœºæµ‹è¯•å‡ ä¸ªé¡µé¢ï¼Œç¡®è®¤æ­£å¸¸

### 4. æƒé™è°ƒæ•´æµ‹è¯•
- [ ] ç®¡ç†å‘˜è¿›å…¥æƒé™ç®¡ç†é¡µé¢
- [ ] ä¸ºä¸šåŠ¡å‘˜æ·»åŠ /ç§»é™¤æƒé™
- [ ] ä¸šåŠ¡å‘˜é‡æ–°ç™»å½•ï¼Œæ£€æŸ¥åŠŸèƒ½é¢æ¿æ˜¯å¦æ­£ç¡®æ›´æ–°
- [ ] ç‚¹å‡»æ–°å¢çš„åŠŸèƒ½é¢æ¿ï¼Œç¡®è®¤èƒ½å¤Ÿè®¿é—®

## ç›¸å…³æ–‡ä»¶

- `src/constants/menuFeatures.ts` - åŠŸèƒ½é¢æ¿å®šä¹‰
- `src/App.tsx` - è·¯ç”±é…ç½®ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
- `src/components/Sidebar.tsx` - ä¾§è¾¹æ ç»„ä»¶
- `src/contexts/authContext.ts` - è®¤è¯ä¸Šä¸‹æ–‡

## ä¿®å¤è„šæœ¬

æ‰§è¡Œä»¥ä¸‹ SQL è„šæœ¬ç¡®ä¿æ•°æ®åº“æƒé™æ­£ç¡®ï¼š
```bash
scripts/check-permissions-status.sql
scripts/fix-salesperson-permissions.sql
```

## æ€»ç»“

**éœ€è¦ç«‹å³ä¿®å¤çš„é—®é¢˜**:
1. âœ… `expert_management` è·¯ç”±æƒé™é…ç½®
2. âœ… `prospectus_management` è·¯ç”±æƒé™é…ç½®

**å¯ä»¥å»¶åçš„é—®é¢˜**:
3. `audit_logs` åŠŸèƒ½å®ç°ï¼ˆå½±å“èŒƒå›´å°ï¼‰

ä¿®å¤è¿™ä¸¤ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜åï¼Œä¸šåŠ¡å‘˜å’Œä¸“å®¶åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è®¿é—®æ‰€æœ‰è¢«æˆäºˆæƒé™çš„åŠŸèƒ½é¢æ¿ã€‚
