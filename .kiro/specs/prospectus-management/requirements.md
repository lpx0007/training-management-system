# 招商简章管理功能需求文档

## 简介

本功能旨在为培训管理系统增加招商简章管理能力，支持招商简章的上传、存储、管理和下载。系统需要支持多期课程共享同一简章，按月份归纳课程，并在课程详情页提供简章下载功能。

## 术语表

- **系统**: 培训管理系统
- **招商简章**: 用于招商的PDF文档，包含课程介绍、培训内容等信息
- **盖章文件**: 经过正式盖章的招商简章PDF文件
- **管理员**: 具有admin角色的用户
- **业务员**: 具有salesperson角色的用户
- **课程**: 培训课程，可以有多期培训场次
- **培训场次**: 具体的培训实施，一个课程可以有多期培训场次
- **月份归纳**: 按照培训开始日期的月份对课程进行分组展示

## 需求

### 需求 1: 招商简章文件上传

**用户故事**: 作为管理员，我希望能够上传招商简章PDF文件，以便业务员可以下载使用

#### 验收标准

1. WHEN 管理员访问招商简章管理页面，THE 系统 SHALL 显示简章列表和上传按钮
2. WHEN 管理员点击上传按钮，THE 系统 SHALL 显示文件选择对话框，仅允许选择PDF格式文件
3. WHEN 管理员选择PDF文件并确认上传，THE 系统 SHALL 验证文件格式为PDF且大小不超过10MB
4. WHEN 文件验证通过，THE 系统 SHALL 将文件上传到Supabase Storage并保存文件元数据到数据库
5. IF 文件格式不正确或大小超限，THEN THE 系统 SHALL 显示错误提示信息

### 需求 2: 招商简章信息管理

**用户故事**: 作为管理员，我希望能够编辑招商简章的基本信息，以便准确描述简章内容

#### 验收标准

1. WHEN 管理员上传简章文件，THE 系统 SHALL 要求输入简章名称、简章类型、适用课程类型等基本信息
2. WHEN 管理员保存简章信息，THE 系统 SHALL 验证必填字段已填写
3. WHEN 管理员点击编辑简章，THE 系统 SHALL 显示编辑表单，允许修改简章名称、类型、描述等信息
4. WHEN 管理员更新简章信息，THE 系统 SHALL 保存更新并显示成功提示
5. WHERE 简章已关联到课程，THE 系统 SHALL 允许管理员更新简章文件，并自动更新所有关联课程的简章链接

### 需求 3: 盖章文件管理

**用户故事**: 作为管理员，我希望能够上传和管理盖章版本的招商简章，以便提供正式的招商文件

#### 验收标准

1. WHEN 管理员查看简章详情，THE 系统 SHALL 显示"上传盖章文件"按钮
2. WHEN 管理员上传盖章文件，THE 系统 SHALL 将盖章文件与原简章关联存储
3. WHEN 盖章文件上传成功，THE 系统 SHALL 在简章列表中标识该简章已有盖章版本
4. WHEN 管理员删除盖章文件，THE 系统 SHALL 提示确认并删除盖章文件，保留原简章
5. WHERE 简章有盖章版本，THE 系统 SHALL 优先提供盖章版本供下载

### 需求 4: 课程与简章关联

**用户故事**: 作为管理员，我希望能够将招商简章关联到课程，以便同类型课程共享简章

#### 验收标准

1. WHEN 管理员创建或编辑培训场次，THE 系统 SHALL 提供选择招商简章的下拉选项
2. WHEN 管理员选择简章，THE 系统 SHALL 将简章ID保存到培训场次记录中
3. WHERE 多个培训场次属于同一课程类型，THE 系统 SHALL 允许它们关联同一份招商简章
4. WHEN 管理员更新简章文件，THE 系统 SHALL 自动更新所有关联培训场次的简章链接
5. WHEN 管理员删除简章，THE 系统 SHALL 检查是否有培训场次关联，如有则提示确认

### 需求 5: 课程详情页简章下载

**用户故事**: 作为业务员，我希望能够在课程详情页直接下载招商简章，以便向客户展示

#### 验收标准

1. WHEN 用户打开培训详情模态框，THE 系统 SHALL 在详情页面显示"招商简章"区域
2. WHERE 培训场次关联了招商简章，THE 系统 SHALL 显示简章名称和下载按钮
3. WHEN 用户点击下载按钮，THE 系统 SHALL 下载简章PDF文件到用户设备
4. WHERE 简章有盖章版本，THE 系统 SHALL 下载盖章版本文件
5. WHERE 培训场次未关联简章，THE 系统 SHALL 显示"暂无招商简章"提示

### 需求 6: 简章下载权限控制

**用户故事**: 作为系统管理员，我希望控制不同角色的简章访问权限，以确保文件安全

#### 验收标准

1. WHEN 管理员访问简章管理页面，THE 系统 SHALL 允许上传、编辑、删除简章
2. WHEN 业务员访问培训详情页，THE 系统 SHALL 允许下载关联的招商简章
3. WHEN 专家访问培训详情页，THE 系统 SHALL 允许查看但不提供下载功能
4. WHERE 用户未登录，THE 系统 SHALL 拒绝访问简章文件
5. WHEN 用户尝试直接访问简章URL，THE 系统 SHALL 验证用户权限后才允许访问

### 需求 7: 简章存储和识别

**用户故事**: 作为系统，我需要可靠地存储和识别招商简章文件，以确保文件完整性和可追溯性

#### 验收标准

1. WHEN 系统存储简章文件，THE 系统 SHALL 使用唯一的文件名格式（时间戳+原文件名）
2. WHEN 系统保存简章元数据，THE 系统 SHALL 记录文件名、存储路径、上传时间、上传人、文件大小
3. WHEN 系统存储盖章文件，THE 系统 SHALL 在文件名中添加"_sealed"标识
4. WHERE 简章被删除，THE 系统 SHALL 同时删除存储文件和数据库记录
5. WHEN 系统检测到文件损坏或丢失，THE 系统 SHALL 在简章列表中标识该简章状态为"文件异常"

### 需求 8: 简章列表展示和搜索

**用户故事**: 作为管理员，我希望能够快速查找和管理招商简章，以提高工作效率

#### 验收标准

1. WHEN 管理员访问简章管理页面，THE 系统 SHALL 显示所有简章的列表，包含名称、类型、上传时间、状态
2. WHEN 管理员在搜索框输入关键词，THE 系统 SHALL 实时筛选匹配的简章
3. WHEN 管理员点击简章名称，THE 系统 SHALL 显示简章详情，包括关联的培训场次列表
4. WHERE 简章有盖章版本，THE 系统 SHALL 在列表中显示盖章标识
5. WHEN 管理员点击删除按钮，THE 系统 SHALL 提示确认并显示关联的培训场次数量

### 需求 9: 简章下载记录

**用户故事**: 作为管理员，我希望能够查看简章的下载记录，以便了解简章使用情况

#### 验收标准

1. WHEN 用户下载简章，THE 系统 SHALL 记录下载时间、下载人、简章名称
2. WHEN 管理员查看简章详情，THE 系统 SHALL 显示该简章的下载次数和最近下载记录
3. WHEN 管理员访问下载记录页面，THE 系统 SHALL 显示所有简章的下载历史
4. WHERE 下载记录超过1000条，THE 系统 SHALL 提供分页功能
5. WHEN 管理员导出下载记录，THE 系统 SHALL 生成Excel文件包含所有下载记录
