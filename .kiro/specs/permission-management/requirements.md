# 权限管理系统需求文档

## 简介

本文档定义了培训管理系统的全面权限管理功能需求。该系统需要为管理员提供完整的权限管理能力，包括对所有用户（管理员、业务员、专家）的权限进行细化管理，实现基于角色和功能模块的权限控制。

## 术语表

- **System**: 培训管理系统
- **Admin**: 系统管理员，拥有最高权限
- **Salesperson**: 业务员，负责客户管理和培训组织
- **Expert**: 专家，负责培训授课
- **Permission**: 权限，定义用户可以执行的操作
- **Permission_Category**: 权限分类，将相关权限分组管理
- **User_List**: 用户列表，显示系统中所有用户
- **Permission_Modal**: 权限设置模态框，用于配置用户权限

## 需求

### 需求 1: 完整的用户列表显示

**用户故事:** 作为管理员，我希望能够查看系统中所有用户（包括管理员、业务员、专家）的完整列表，以便统一管理所有人员的权限。

#### 验收标准

1. WHEN Admin访问权限管理页面，THE System SHALL显示包含所有角色用户的完整列表
2. THE System SHALL在用户列表中显示每个用户的姓名、角色、部门、状态和当前权限数量
3. THE System SHALL支持按用户姓名、角色、部门进行搜索和筛选
4. THE System SHALL为不同角色的用户显示不同的角色标识（管理员、业务员、专家）
5. THE System SHALL显示每个用户当前已分配的权限数量和主要权限标签

### 需求 2: 细化的权限分类体系

**用户故事:** 作为管理员，我希望权限能够按照功能模块进行分类管理，以便更清晰地理解和分配权限。

#### 验收标准

1. THE System SHALL将所有权限按功能模块分为以下类别：客户管理、培训管理、专家管理、业务员管理、招商简章管理、海报生成、数据管理、系统管理
2. WHEN Admin打开权限设置模态框，THE System SHALL按分类展示所有可用权限
3. THE System SHALL在每个权限分类下显示该分类包含的所有具体权限
4. THE System SHALL为每个权限显示清晰的名称和功能描述
5. THE System SHALL支持在权限设置界面中折叠和展开权限分类

### 需求 3: 全面的权限项定义

**用户故事:** 作为管理员，我希望系统提供覆盖所有功能模块的细化权限项，以便精确控制用户的操作范围。

#### 验收标准

1. THE System SHALL提供客户管理类权限：查看客户、添加客户、编辑客户、删除客户、导出客户数据、查看所有客户（跨业务员）
2. THE System SHALL提供培训管理类权限：查看培训、添加培训、编辑培训、删除培训、添加培训参与者、管理培训参与者、查看培训统计
3. THE System SHALL提供专家管理类权限：查看专家、添加专家、编辑专家、删除专家、查看专家反馈、编辑自己的专家资料
4. THE System SHALL提供业务员管理类权限：查看业务员、添加业务员、编辑业务员、删除业务员、查看业务员绩效
5. THE System SHALL提供招商简章管理类权限：查看简章、上传简章、编辑简章、删除简章、下载简章、管理简章分类
6. THE System SHALL提供海报生成类权限：生成海报、查看海报历史、配置海报模板
7. THE System SHALL提供数据管理类权限：导入数据、导出数据、下载模板、查看数据管理历史
8. THE System SHALL提供系统管理类权限：管理权限、查看审计日志、系统配置、用户账号管理

### 需求 4: 实时权限配置功能

**用户故事:** 作为管理员，我希望能够实时为用户分配或撤销权限，并立即生效，以便灵活管理用户的访问控制。

#### 验收标准

1. WHEN Admin点击用户的"管理权限"按钮，THE System SHALL打开权限设置模态框并显示该用户当前的权限配置
2. THE System SHALL允许Admin通过复选框勾选或取消勾选来分配或撤销权限
3. WHEN Admin保存权限设置，THE System SHALL立即更新数据库中的用户权限记录
4. THE System SHALL在权限保存成功后显示成功提示消息
5. THE System SHALL在权限设置模态框中提供"全选"、"清空"和"恢复默认"快捷操作按钮

### 需求 5: 权限验证和访问控制

**用户故事:** 作为系统用户，我希望系统能够根据我的权限配置控制我可以访问的功能和数据，以确保数据安全。

#### 验收标准

1. WHEN用户登录系统，THE System SHALL从数据库加载该用户的所有权限
2. THE System SHALL在用户访问任何功能页面时验证其是否拥有相应权限
3. IF用户没有访问某功能的权限，THEN THE System SHALL隐藏该功能的入口或显示无权限提示
4. THE System SHALL在用户尝试执行操作时再次验证权限，防止绕过前端限制
5. THE System SHALL在权限验证失败时记录审计日志

### 需求 6: 角色默认权限模板

**用户故事:** 作为管理员，我希望系统能够为不同角色提供默认权限模板，以便快速为新用户分配合适的权限。

#### 验收标准

1. THE System SHALL为管理员角色提供包含所有权限的默认模板
2. THE System SHALL为业务员角色提供包含客户管理、培训查看、简章下载等基础权限的默认模板
3. THE System SHALL为专家角色提供包含查看培训、编辑自己资料等权限的默认模板
4. WHEN Admin创建新用户时，THE System SHALL自动应用该角色的默认权限模板
5. THE System SHALL允许Admin在应用默认模板后进一步自定义用户权限

### 需求 7: 权限变更历史记录

**用户故事:** 作为管理员，我希望系统能够记录所有权限变更操作，以便追溯和审计权限管理活动。

#### 验收标准

1. WHEN Admin修改用户权限，THE System SHALL在审计日志中记录操作者、被操作用户、变更时间和变更内容
2. THE System SHALL记录每次权限变更的详细信息，包括添加的权限和撤销的权限
3. THE System SHALL允许Admin查看特定用户的权限变更历史
4. THE System SHALL在审计日志中保留权限变更记录至少90天
5. THE System SHALL支持按时间范围、操作者、被操作用户筛选权限变更记录

### 需求 8: 权限统计和分析

**用户故事:** 作为管理员，我希望能够查看权限分配的统计信息，以便了解系统的权限使用情况。

#### 验收标准

1. THE System SHALL在权限管理页面显示系统用户总数和各角色用户数量
2. THE System SHALL显示系统中定义的权限总数和各分类的权限数量
3. THE System SHALL统计并显示每个权限被分配给多少用户
4. THE System SHALL识别并显示没有分配任何权限的用户
5. THE System SHALL识别并显示拥有所有权限的用户（超级管理员）

### 需求 9: 批量权限操作

**用户故事:** 作为管理员，我希望能够批量为多个用户分配或撤销权限，包括按角色批量设置和按选中用户批量设置两种方式，以提高权限管理效率。

#### 验收标准

1. THE System SHALL提供两种批量权限设置方式：按角色批量设置和按选中用户批量设置
2. THE System SHALL在权限管理页面显示"按角色批量设置权限"区域，包含管理员、业务员、专家三个角色的快捷设置按钮
3. WHEN Admin点击某角色的"设置权限"按钮，THE System SHALL打开角色权限设置模态框并显示该角色的默认权限模板
4. THE System SHALL在角色权限设置模态框中显示将受影响的用户数量
5. THE System SHALL提供三种批量更新策略：完全覆盖、合并模式、重置为角色默认
6. WHEN Admin为角色批量设置权限，THE System SHALL将权限应用到该角色的所有用户
7. THE System SHALL允许Admin在用户列表中通过复选框选择多个用户
8. WHEN Admin选择多个用户后，THE System SHALL显示批量操作按钮
9. THE System SHALL支持批量添加权限操作，将指定权限添加到所有选中用户
10. THE System SHALL支持批量撤销权限操作，从所有选中用户移除指定权限
11. WHEN执行批量操作，THE System SHALL显示操作进度和结果摘要
12. THE System SHALL在批量操作前显示确认对话框，说明操作影响范围

### 需求 10: 权限冲突检测和提示

**用户故事:** 作为管理员，我希望系统能够检测并提示潜在的权限配置问题，以避免权限管理错误。

#### 验收标准

1. WHEN Admin为用户分配权限时，THE System SHALL检测是否存在权限依赖关系
2. IF某权限需要其他前置权限，THEN THE System SHALL提示Admin同时分配前置权限
3. THE System SHALL检测并警告可能导致安全风险的权限组合
4. WHEN Admin尝试撤销某权限时，IF该权限被其他权限依赖，THEN THE System SHALL显示警告提示
5. THE System SHALL在保存权限配置前验证权限组合的合理性

### 需求 11: 功能面板访问控制

**用户故事:** 作为管理员，我希望能够控制用户可以访问哪些功能面板（导航菜单项），并且功能面板的访问与具体权限关联，以实现更灵活的访问控制。

#### 验收标准

1. THE System SHALL提供独立的功能面板访问控制，与具体功能权限分离
2. THE System SHALL在权限设置模态框中提供"功能面板"和"功能权限"两个标签页
3. WHEN Admin启用某功能面板时，THE System SHALL检查用户是否拥有该功能面板所需的基础权限
4. IF用户缺少功能面板所需的基础权限，THEN THE System SHALL提示Admin同时分配所需权限
5. THE System SHALL在用户登录后根据功能面板访问权限动态生成侧边栏导航菜单
6. WHEN用户访问某功能面板时，THE System SHALL验证用户是否同时拥有功能面板访问权限和所需的功能权限
7. THE System SHALL为不同角色提供默认的功能面板访问模板
8. THE System SHALL允许Admin为业务员启用"海报生成"功能面板，使其可以访问海报生成功能
9. THE System SHALL确保只有同时拥有功能面板访问权限和相应功能权限的用户才能使用该功能
10. THE System SHALL在功能面板配置界面显示每个功能面板所需的基础权限列表
