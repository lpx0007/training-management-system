name: Sync to Gitee

on:
  push:
    branches:
      - main
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    name: åŒæ­¥ä»£ç åˆ° Gitee
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–å®Œæ•´å†å²è®°å½•

      - name: åŒæ­¥åˆ° Gitee
        uses: wearerequired/git-mirror-action@v1
        env:
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_PRIVATE_KEY }}
        with:
          source-repo: https://github.com/${{ github.repository }}.git
          destination-repo: git@gitee.com:lpx007/training-management.git

      - name: åŒæ­¥æˆåŠŸé€šçŸ¥
        if: success()
        run: |
          echo "âœ… æˆåŠŸåŒæ­¥åˆ° Gitee"
          echo "ğŸ“¦ ä»“åº“: https://gitee.com/lpx007/training-management"
          echo "ğŸš€ EdgeOne å°†è‡ªåŠ¨å¼€å§‹éƒ¨ç½²"
          echo "â° æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"

      - name: åŒæ­¥å¤±è´¥é€šçŸ¥
        if: failure()
        run: |
          echo "âŒ åŒæ­¥åˆ° Gitee å¤±è´¥"
          echo "ğŸ” è¯·æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š"
          echo "   1. GitHub Secret: GITEE_PRIVATE_KEY æ˜¯å¦æ­£ç¡®"
          echo "   2. Gitee éƒ¨ç½²å…¬é’¥æ˜¯å¦å·²æ·»åŠ "
          echo "   3. Gitee éƒ¨ç½²å…¬é’¥æ˜¯å¦å‹¾é€‰äº†'å…è®¸æ¨é€'"
          echo "   4. ä»“åº“åœ°å€æ˜¯å¦æ­£ç¡®"
