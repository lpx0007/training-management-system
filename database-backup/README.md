# æ•°æ®åº“å¤‡ä»½ç³»ç»Ÿ

## ğŸ“ ç›®å½•ç»“æ„

```
database-backup/
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶ - ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ backup.js              # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ backup.bat             # Windows å¿«æ·æ–¹å¼
â”œâ”€â”€ current-schema.sql     # å½“å‰æ•°æ®åº“ç»“æ„æ¨¡æ¿
â””â”€â”€ history/               # å†å²å¤‡ä»½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â”œâ”€â”€ backup_20250127_141530.sql
    â”œâ”€â”€ backup_20250126_141530.sql
    â””â”€â”€ ...                # ä¿ç•™æœ€è¿‘ 10 ä¸ªå¤‡ä»½
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰

åŒå‡» `backup.bat` æ–‡ä»¶å³å¯ï¼

### æ–¹æ³• 2: ä½¿ç”¨å‘½ä»¤è¡Œ

```bash
# è¿›å…¥å¤‡ä»½ç›®å½•
cd database-backup

# è¿è¡Œå¤‡ä»½
node backup.js
```

### æ–¹æ³• 3: ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ

```bash
node database-backup/backup.js
```

---

## ğŸ“‹ å·¥ä½œåŸç†

1. **è¯»å–æ¨¡æ¿**: è¯»å– `current-schema.sql`ï¼ˆå½“å‰æ•°æ®åº“ç»“æ„ï¼‰
2. **æ·»åŠ æ—¶é—´æˆ³**: åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ç”Ÿæˆæ—¶é—´å’Œé¡¹ç›®ä¿¡æ¯
3. **ä¿å­˜å¤‡ä»½**: ä¿å­˜åˆ° `history/backup_YYYYMMDD_HHMMSS.sql`
4. **è‡ªåŠ¨æ¸…ç†**: ä¿ç•™æœ€è¿‘ 10 ä¸ªå¤‡ä»½ï¼Œåˆ é™¤æ›´æ—©çš„

---

## ğŸ”„ æ›´æ–°æ•°æ®åº“ç»“æ„æ¨¡æ¿

å½“æ•°æ®åº“ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ·»åŠ è¡¨ã€ä¿®æ”¹å­—æ®µç­‰ï¼‰ï¼Œéœ€è¦æ›´æ–° `current-schema.sql`ï¼š

### æ–¹æ³• 1: ä½¿ç”¨ Supabase CLIï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Supabase CLI
npm install -g supabase

# ç™»å½•
supabase login

# å¯¼å‡ºæœ€æ–°ç»“æ„åˆ°å¤‡ä»½ç›®å½•
supabase db dump --project-ref qinpsvempgjjocjfjvpc > database-backup/current-schema.sql
```

### æ–¹æ³• 2: ä½¿ç”¨ pg_dump

```bash
# ä» Supabase Dashboard è·å–æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
# Project Settings > Database > Connection string

pg_dump "your_database_url" \
  --schema=public \
  --schema-only \
  --no-owner \
  --no-acl \
  --clean \
  --if-exists \
  > database-backup/current-schema.sql
```

### æ–¹æ³• 3: æ‰‹åŠ¨ç¼–è¾‘

ç›´æ¥ç¼–è¾‘ `current-schema.sql` æ–‡ä»¶

---

## ğŸ“¦ å¤‡ä»½å†…å®¹

æ¯ä¸ªå¤‡ä»½æ–‡ä»¶åŒ…å«ï¼š

- âœ… æ‰€æœ‰è¡¨ç»“æ„ï¼ˆCREATE TABLEï¼‰
- âœ… æ‰€æœ‰ç´¢å¼•ï¼ˆCREATE INDEXï¼‰
- âœ… æ‰€æœ‰çº¦æŸï¼ˆPRIMARY KEY, FOREIGN KEY, UNIQUE, CHECKï¼‰
- âœ… æ‰€æœ‰è§¦å‘å™¨ï¼ˆCREATE TRIGGERï¼‰
- âœ… æ‰€æœ‰ RLS ç­–ç•¥ï¼ˆCREATE POLICYï¼‰
- âœ… é»˜è®¤æ•°æ®ï¼ˆINSERT INTO permissionsï¼‰
- âœ… ç”Ÿæˆæ—¶é—´æˆ³å’Œé¡¹ç›®ä¿¡æ¯

**ä¸åŒ…å«**ï¼š
- âŒ ç”¨æˆ·æ•°æ®ï¼ˆåªæœ‰ç»“æ„ï¼Œä¸åŒ…å«æ•°æ®ï¼‰
- âŒ auth.users è¡¨ï¼ˆç”± Supabase ç®¡ç†ï¼‰

---

## ğŸ”§ è‡ªåŠ¨åŒ–å¤‡ä»½

### æ–¹æ³• 1: Windows ä»»åŠ¡è®¡åˆ’ç¨‹åº

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è§¦å‘å™¨ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹
4. æ“ä½œï¼šå¯åŠ¨ç¨‹åº
   - ç¨‹åºï¼š`E:\åŸ¹è®­æœºæ„ä¸šåŠ¡é€š\database-backup\backup.bat`

### æ–¹æ³• 2: æ·»åŠ åˆ° package.json

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `package.json` ä¸­æ·»åŠ ï¼š

```json
{
  "scripts": {
    "backup": "node database-backup/backup.js"
  }
}
```

ç„¶åè¿è¡Œï¼š

```bash
npm run backup
```

---

## ğŸ“ æ¢å¤æ•°æ®åº“

### ä»å¤‡ä»½æ¢å¤

1. åœ¨ Supabase Dashboard ä¸­æ‰“å¼€ SQL Editor
2. å¤åˆ¶å¤‡ä»½æ–‡ä»¶çš„å†…å®¹
3. æ‰§è¡Œ SQL

æˆ–è€…ä½¿ç”¨ psqlï¼š

```bash
psql "your_database_url" < database-backup/history/backup_YYYYMMDD_HHMMSS.sql
```

### âš ï¸ æ³¨æ„äº‹é¡¹

- æ¢å¤ä¼šåˆ é™¤ç°æœ‰è¡¨ï¼ˆå› ä¸ºä½¿ç”¨äº† `DROP TABLE IF EXISTS`ï¼‰
- å»ºè®®åœ¨æ–°é¡¹ç›®ä¸­æµ‹è¯•æ¢å¤
- æ¢å¤å‰è¯·ç¡®ä¿æœ‰å®Œæ•´å¤‡ä»½

---

## ğŸ” æŸ¥çœ‹å¤‡ä»½å†å²

```bash
# Windows
dir database-backup\history

# Linux/Mac
ls -lh database-backup/history
```

---

## â“ å¸¸è§é—®é¢˜

### Q: å¤‡ä»½åŒ…å«æ•°æ®å—ï¼Ÿ

A: ä¸åŒ…å«ã€‚åªå¤‡ä»½æ•°æ®åº“ç»“æ„ï¼ˆè¡¨ã€ç´¢å¼•ã€çº¦æŸç­‰ï¼‰ï¼Œä¸åŒ…å«å®é™…æ•°æ®ã€‚

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: ä½¿ç”¨ Supabase Dashboard çš„å¯¼å‡ºåŠŸèƒ½ï¼Œæˆ–ä½¿ç”¨ `pg_dump` ä¸å¸¦ `--schema-only` å‚æ•°ã€‚

### Q: å¤‡ä»½æ–‡ä»¶å®‰å…¨å—ï¼Ÿ

A: å¤‡ä»½æ–‡ä»¶åŒ…å«æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼Œå»ºè®®ä¸è¦æäº¤åˆ°å…¬å…± Git ä»“åº“ã€‚å·²åœ¨ `.gitignore` ä¸­æ’é™¤ã€‚

### Q: ä¸ºä»€ä¹ˆè¦ä¿ç•™å†å²å¤‡ä»½ï¼Ÿ

A: å¯ä»¥å›æº¯åˆ°ä¹‹å‰çš„æ•°æ®åº“ç»“æ„ç‰ˆæœ¬ï¼Œç”¨äºå¯¹æ¯”å˜æ›´æˆ–æ¢å¤åˆ°ç‰¹å®šæ—¶é—´ç‚¹ã€‚

### Q: å¯ä»¥ä¿®æ”¹ä¿ç•™çš„å¤‡ä»½æ•°é‡å—ï¼Ÿ

A: å¯ä»¥ã€‚ç¼–è¾‘ `backup.js` æ–‡ä»¶ï¼Œæ‰¾åˆ° `files.slice(10)` è¿™ä¸€è¡Œï¼Œå°† 10 æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡ã€‚

---

## ğŸ“Š å¤‡ä»½ç»Ÿè®¡

è¿è¡Œå¤‡ä»½åï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºï¼š

```
========================================
Supabase æ•°æ®åº“å¤‡ä»½å·¥å…·
========================================

æ­£åœ¨ç”Ÿæˆå¤‡ä»½...

âœ“ å¤‡ä»½å·²ä¿å­˜åˆ°: database-backup/history/backup_20250127_141530.sql
âœ“ å¤‡ä»½æ–‡ä»¶å¤§å°: 45.23 KB

æ­£åœ¨æ¸…ç†æ—§å¤‡ä»½...
âœ“ å½“å‰ä¿ç•™ 10 ä¸ªå†å²å¤‡ä»½

========================================
å¤‡ä»½å®Œæˆï¼
========================================

å½“å‰æ¨¡æ¿: database-backup/current-schema.sql
æœ€æ–°å¤‡ä»½: database-backup/history/backup_20250127_141530.sql
å†å²ç›®å½•: database-backup/history
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**
   - æ¯å¤©è‡ªåŠ¨å¤‡ä»½ä¸€æ¬¡
   - é‡å¤§æ›´æ”¹å‰æ‰‹åŠ¨å¤‡ä»½
   - éƒ¨ç½²å‰å¤‡ä»½

2. **æ›´æ–°æ¨¡æ¿**
   - æ•°æ®åº“ç»“æ„å˜åŒ–åç«‹å³æ›´æ–° `current-schema.sql`
   - ä½¿ç”¨ Supabase CLI è‡ªåŠ¨å¯¼å‡º
   - æäº¤æ¨¡æ¿åˆ° Gitï¼ˆä½†ä¸æäº¤å†å²å¤‡ä»½ï¼‰

3. **æµ‹è¯•æ¢å¤**
   - å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹
   - åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯å¤‡ä»½å®Œæ•´æ€§

4. **äº‘å­˜å‚¨**
   - å®šæœŸä¸Šä¼ å†å²å¤‡ä»½åˆ°äº‘å­˜å‚¨ï¼ˆGoogle Drive, OneDrive ç­‰ï¼‰
   - ä¿æŒå¼‚åœ°å¤‡ä»½

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `current-schema.sql` - å½“å‰æ•°æ®åº“ç»“æ„æ¨¡æ¿
- `backup.js` - å¤‡ä»½è„šæœ¬
- `backup.bat` - Windows å¿«æ·æ–¹å¼
- `history/` - å†å²å¤‡ä»½ç›®å½•
- `README.md` - æœ¬æ–‡ä»¶

---

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜ 1: "æœªæ‰¾åˆ°æ•°æ®åº“ç»“æ„æ¨¡æ¿æ–‡ä»¶"

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ `current-schema.sql` æ–‡ä»¶å­˜åœ¨äº `database-backup` ç›®å½•ä¸­ã€‚

### é—®é¢˜ 2: æ— æ³•åˆ›å»ºå†å²ç›®å½•

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œç¡®ä¿æœ‰å†™å…¥æƒé™ã€‚

### é—®é¢˜ 3: å¤‡ä»½æ–‡ä»¶å¤ªå¤§

**è§£å†³æ–¹æ¡ˆ**: è¿™æ˜¯æ­£å¸¸çš„ï¼Œå®Œæ•´çš„æ•°æ®åº“ç»“æ„å¯èƒ½æœ‰å‡ å KBã€‚å¦‚æœè¶…è¿‡ 1MBï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«äº†æ•°æ®ã€‚

---

## ğŸ“… æ›´æ–°æ—¥å¿—

### 2025-01-27
- âœ… åˆ›å»ºå¤‡ä»½ç³»ç»Ÿ
- âœ… åˆ›å»º Node.js å¤‡ä»½è„šæœ¬
- âœ… åˆ›å»º Windows æ‰¹å¤„ç†æ–‡ä»¶
- âœ… æ·»åŠ è‡ªåŠ¨æ¸…ç†åŠŸèƒ½
- âœ… åˆ›å»ºä½¿ç”¨æ–‡æ¡£

---

## ğŸ’¡ æç¤º

- å¤‡ä»½å¾ˆå¿«ï¼Œé€šå¸¸åªéœ€è¦å‡ ç§’é’Ÿ
- å†å²å¤‡ä»½ä¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¸ç”¨æ‹…å¿ƒå ç”¨å¤ªå¤šç©ºé—´
- å¯ä»¥éšæ—¶æŸ¥çœ‹å†å²å¤‡ä»½ï¼Œå¯¹æ¯”æ•°æ®åº“ç»“æ„çš„å˜åŒ–
- å»ºè®®æ¯æ¬¡ä¿®æ”¹æ•°æ®åº“ç»“æ„åéƒ½è¿è¡Œä¸€æ¬¡å¤‡ä»½

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹æœ¬æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
