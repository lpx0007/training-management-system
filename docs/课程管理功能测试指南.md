# 课程管理功能测试指南

**版本**: v1.2  
**更新时间**: 2025-11-08 14:40  
**测试范围**: 添加/编辑课程功能 + 自动编号生成

---

## ✅ 已完成的功能

### 1. 课程表单模态框（CourseFormModal）

**文件**: `src/components/CourseFormModal.tsx`

**功能特性**:
- ✅ 支持添加和编辑两种模式
- ✅ 完整的表单验证
- ✅ 实时错误提示
- ✅ 加载状态显示
- ✅ 响应式布局

**表单字段**:
- 课程模块（必填） - 下拉选择10个模块
- 课程名称（必填）
- ~~课程编号（必填）~~ ⭐ **已改为自动生成**
- 每期天数（必填）- 数字输入
- 全年期数（必填）- 数字输入
- 标准费用（必填）- 金额输入
- 线上价格（选填）- 金额输入
- 线下价格（选填）- 金额输入
- ~~均价（选填）~~ ⭐ **已移除（内部测算用）**
- 课程描述（选填）- 多行文本
- 备注（选填）- 多行文本
- 状态 - 启用/停用

### 2. 页面集成

**文件**: `src/pages/CourseManagement.tsx`

**更新内容**:
- ✅ 导入CourseFormModal组件
- ✅ 添加模态框状态管理
- ✅ 实现handleAddCourse处理函数
- ✅ 实现handleEditCourse处理函数
- ✅ 实现openEditModal函数
- ✅ 渲染添加和编辑模态框

### 3. 服务层优化

**文件**: `src/lib/services/courseService.ts`

**更新内容**:
- ✅ createCourse支持Course和CourseDB两种类型
- ✅ updateCourse支持Course和CourseDB两种类型
- ✅ 新增getCourseById方法

---

## 🧪 测试步骤

### 测试1: 添加新课程（含自动编号） ⭐

#### 步骤：
1. 登录系统（使用管理员账号）
2. 进入"课程管理"页面
3. 点击右上角"添加课程"按钮
4. **观察表单**：
   - ✅ 没有"课程编号"输入框
   - ✅ 没有"均价"输入框
5. 填写表单：
   - 模块：选择"管理会计"
   - 课程名称：测试课程自动编号
   - 每期天数：2
   - 全年期数：4
   - 标准费用：5000
   - 线上价格：4000
   - 线下价格：5000
6. 点击"保存"按钮

#### 预期结果：
- ✅ 表单验证通过
- ✅ 显示"课程添加成功"提示
- ✅ 模态框关闭
- ✅ 课程列表自动刷新
- ✅ 新课程出现在列表中
- ✅ **自动生成编号（如：C-0047）**

#### 验证SQL：
```sql
-- 查看最新添加的课程及其自动生成的编号
SELECT id, code, name, created_at 
FROM courses 
ORDER BY created_at DESC 
LIMIT 1;

-- 编号格式应为：C-XXXX（4位数字，不足补0）
-- 例如：C-0047, C-0048, C-0100
```

---

### 测试2: 表单验证

#### 测试2.1: 必填字段验证

**步骤**:
1. 点击"添加课程"
2. 不填写任何字段
3. 点击"保存"

**预期结果**:
- ❌ 显示错误提示："请选择课程模块"
- ❌ 显示错误提示："请输入课程名称"
- ❌ 不提交表单

#### 测试2.2: 数字字段验证

**步骤**:
1. 填写基本信息
2. 每期天数设为0
3. 全年期数设为0
4. 标准费用设为0
5. 点击"保存"

**预期结果**:
- ❌ 显示错误："每期天数必须大于0"
- ❌ 显示错误："全年期数必须大于0"
- ❌ 显示错误："标准费用必须大于0"

---

### 测试3: 编辑现有课程（编号只读） ⭐

#### 步骤：
1. 在课程列表中找到任意课程
2. 点击课程卡片上的"编辑"按钮（铅笔图标）
3. **观察表单**：
   - ✅ 显示"课程编号"字段（灰色背景，只读）
   - ✅ 鼠标悬停显示禁止符号
   - ✅ 提示文字："编号由系统自动生成，不可修改"
   - ✅ 仍然没有"均价"字段
4. 表单应自动填充课程数据
5. 尝试点击编号字段（应无法编辑）
6. 修改课程名称：在原名称后加" (已编辑)"
7. 修改标准费用：改为新的金额
8. 点击"保存"

#### 预期结果：
- ✅ 模态框标题显示"编辑课程"
- ✅ 所有字段自动填充当前值
- ✅ **课程编号显示但不可修改**
- ✅ 显示"课程更新成功"提示
- ✅ 模态框关闭
- ✅ 课程列表自动刷新
- ✅ 修改后的数据立即显示
- ✅ **课程编号保持不变**

#### 验证SQL：
```sql
SELECT id, code, name, standard_fee, updated_at 
FROM courses 
WHERE id = <课程ID>;

-- 验证编号未改变
```

---

### 测试4: 取消操作

#### 步骤：
1. 点击"添加课程"
2. 填写部分表单数据
3. 点击"取消"按钮或点击背景遮罩

#### 预期结果：
- ✅ 模态框关闭
- ✅ 未保存任何数据
- ✅ 下次打开表单时为空白状态

---

### 测试5: 编辑时的数据加载

#### 步骤：
1. 点击任意课程的"编辑"按钮
2. 观察加载过程

#### 预期结果：
- ✅ 调用getCourseById获取最新数据
- ✅ 表单正确填充所有字段值
- ✅ null值字段显示为空
- ✅ 数字字段显示正确的数值

---

### 测试6: 编号唯一性和连续性 ⭐ 新增

#### 步骤：
1. 连续添加3个新课程
2. 观察生成的编号
3. 查询数据库验证

#### 预期结果：
- ✅ 编号格式统一（C-XXXX）
- ✅ 编号连续递增
- ✅ 无重复编号
- ✅ 编号基于数据库ID生成

#### 验证SQL：
```sql
-- 查看最近添加的3个课程
SELECT id, code, name, created_at 
FROM courses 
ORDER BY id DESC 
LIMIT 3;

-- 检查是否有重复编号
SELECT code, COUNT(*) as count 
FROM courses 
WHERE code LIKE 'C-%'
GROUP BY code 
HAVING COUNT(*) > 1;
-- 应返回0行，表示无重复

-- 统计新旧格式编号数量
SELECT 
  CASE 
    WHEN code LIKE 'C-%' THEN '新格式(C-XXXX)'
    ELSE '旧格式'
  END as format_type,
  COUNT(*) as count
FROM courses 
GROUP BY format_type;
```

---

### 测试7: 线上/线下价格

#### 步骤：
1. 添加课程时设置线上和线下价格
2. 保存后编辑该课程
3. 验证价格正确显示

#### 预期结果：
- ✅ 线上价格正确保存和显示
- ✅ 线下价格正确保存和显示
- ✅ 未填写的价格字段为null

---

## 🐛 已知问题和限制

### v1.2 新增功能 ⭐
1. ✅ **课程编号自动生成**（格式：C-0001）
2. ✅ **移除均价字段**（内部测算用）
3. ✅ **编号唯一性保证**（基于数据库ID）

### 当前限制：
1. ⚠️ 列表视图尚未实现
2. ⚠️ 合并视图尚未完善
3. ⚠️ 删除课程功能未实现
4. ⚠️ 批量操作未实现
5. ⚠️ 编号格式不支持自定义

### 计划改进：
- [x] ~~添加课程编号唯一性验证~~ ✅ 已完成
- [ ] 实现列表视图（表格形式）
- [ ] 完善合并视图
- [ ] 添加删除确认对话框
- [ ] 添加批量编辑功能
- [ ] 添加课程复制功能
- [ ] 支持编号格式自定义（如按模块）

---

## 📊 测试结果记录表

| 测试项 | 状态 | 备注 | 测试人 | 测试时间 |
|--------|------|------|--------|----------|
| 添加新课程（含自动编号） | ⬜ 待测试 | v1.2新增 | | |
| 必填字段验证 | ⬜ 待测试 | | | |
| 数字字段验证 | ⬜ 待测试 | | | |
| 编辑现有课程（编号只读） | ⬜ 待测试 | v1.2新增 | | |
| 取消操作 | ⬜ 待测试 | | | |
| 数据加载 | ⬜ 待测试 | | | |
| 编号唯一性和连续性 | ⬜ 待测试 | v1.2新增 | | |
| 线上/线下价格 | ⬜ 待测试 | | | |

---

## 🎯 下一步优化建议

### 高优先级（1-2天）
1. ~~**课程编号唯一性验证**~~ ✅ **已完成（v1.2）**
   - ✅ 自动生成唯一编号
   - ✅ 基于数据库ID
   - ✅ 格式统一（C-XXXX）

2. **删除课程功能**
   - 确认对话框
   - 级联删除检查
   - 软删除选项

3. **列表视图实现**
   - 表格布局
   - 排序功能
   - 快速编辑

### 中优先级（3-5天）
4. **批量操作**
   - 批量导入
   - 批量导出
   - 批量修改状态

5. **高级筛选**
   - 多条件组合
   - 价格范围筛选
   - 创建时间筛选

### 低优先级（体验优化）
6. **用户体验优化**
   - 表单草稿保存
   - 撤销/重做功能
   - 键盘快捷键

---

## 💡 测试提示

### 浏览器开发者工具
打开控制台（F12）查看：
- 网络请求状态
- 错误日志
- 性能指标

### Supabase Dashboard
登录 https://supabase.com 查看：
- 数据库实时变化
- API请求日志
- 性能监控

### 测试数据清理
```sql
-- 删除测试课程
DELETE FROM courses 
WHERE code LIKE 'TEST-%';

-- 查看最近添加的课程
SELECT * FROM courses 
ORDER BY created_at DESC 
LIMIT 10;
```

---

## ✨ 测试通过标准

- ✅ 所有必填字段验证正常
- ✅ 数据正确保存到数据库
- ✅ UI实时更新
- ✅ 无JavaScript错误
- ✅ 无SQL错误
- ✅ 用户体验流畅
- ✅ 响应式布局正常

---

**测试负责人**: _____________  
**测试日期**: _____________  
**测试结果**: ⬜ 通过 ⬜ 部分通过 ⬜ 未通过  
**备注**: _____________________________________________
