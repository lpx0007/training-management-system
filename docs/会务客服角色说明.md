# 会务客服角色功能说明

**创建日期**: 2025-11-15  
**版本**: v1.0  
**状态**: ✅ 已实施  

## 角色定义

会务客服（conference_service）是一个新增的系统角色，主要负责查看培训计划，协助培训活动的会务工作。

## 注册和角色分配流程

### 注册流程
会务客服的注册流程与业务员完全相同：

1. **用户注册** - 新用户通过注册页面注册账号
2. **初始角色** - 系统自动分配为 `salesperson` 角色
3. **管理员修改** - 管理员在"员工管理"页面将职位改为"会务客服"
4. **自动更新** - 系统自动变更角色为 `conference_service` 并分配对应权限

### 角色变更操作（管理员）

1. 进入**员工管理**页面
2. 找到需要变更的员工，点击**编辑**
3. 在"职位/角色"下拉框中选择"会务客服"
4. 点击保存
5. 系统自动完成：
   - 角色变更为 `conference_service`
   - 分配会务客服默认权限
   - 分配会务客服默认菜单访问

## 默认权限

会务客服拥有以下默认权限：

### 培训管理（与业务员相同）
- ✅ **training_view** - 查看培训计划
- ✅ **training_add_participant** - 添加培训参与者
- ✅ **training_manage_participant** - 管理培训参与者
- ✅ **training_export_participants** - 导出参训人员名单

### 客户管理（可以看到和管理所有客户）
- ✅ **customer_view** - 查看客户
- ✅ **customer_view_all** - 查看所有客户（跨业务员）
- ✅ **customer_edit** - 编辑客户信息

### 业绩查看
- ✅ **salesperson_view_performance** - 查看课程业绩

### 专家管理
- ✅ **expert_view** - 查看专家信息

### 招商简章
- ✅ **prospectus_view** - 查看简章
- ✅ **prospectus_download** - 下载简章

### 无权限的功能
- ❌ 添加/编辑/删除培训计划
- ❌ 添加/删除客户
- ❌ 业务员管理
- ❌ 课程管理
- ❌ 数据导入导出（可导出参训人员）

## 默认菜单访问

会务客服可以访问以下菜单：

1. **仪表盘** (dashboard)
   - 查看系统概览和统计数据

2. **培训计划** (training_management)
   - 查看培训场次列表
   - 查看培训详情
   - 添加参训人员
   - 管理参训人员信息
   - 导出参训人员名单

3. **客户管理** (customer_management)
   - 查看所有客户信息（跨业务员）
   - 编辑客户信息
   - 查看客户跟进记录

4. **销售追踪** (sales_tracking)
   - 查看课程销售业绩
   - 查看业务员业绩排行
   - 查看业绩统计图表

5. **专家管理** (expert_management)
   - 查看专家信息
   - 查看专家课程安排

6. **招商简章** (prospectus_management)
   - 查看招商简章列表
   - 下载简章文件

7. **个人设置** (profile_settings)
   - 修改个人资料
   - 修改密码

## 使用场景

### 典型工作流程

1. **查看培训计划**
   - 登录系统后进入"培训计划"页面
   - 查看即将开始、进行中和已完成的培训
   - 了解培训的时间、地点、课程等信息

2. **管理参训人员**
   - 点击培训详情
   - 查看已报名的参训人员名单
   - 添加新的参训人员
   - 编辑参训人员信息（如联系方式、参与模式等）
   - 导出参训人员名单用于制作签到表

3. **管理客户信息**
   - 查看所有业务员的客户
   - 编辑客户联系方式和备注
   - 为培训添加合适的客户

4. **查看业绩数据**
   - 查看各课程的销售业绩
   - 了解参训人数和收入情况
   - 协助业务员统计业绩

5. **协助会务工作**
   - 根据培训信息准备会务物资
   - 安排培训场地
   - 协调培训相关事宜
   - 下载招商简章发送给客户

## 权限扩展

如果需要为会务客服添加更多权限，管理员可以：

1. 进入**权限管理**页面
2. 选择会务客服用户
3. 手动添加需要的权限（如导出参训人员、查看简章等）

## 技术实现

### 角色类型定义
```typescript
// src/lib/supabase/types.ts
export type UserRole = 'admin' | 'salesperson' | 'expert' | 'manager' | 'conference_service';
```

### 默认权限配置
```typescript
// src/constants/permissions.ts
conference_service: [
  // 培训管理（与业务员相同）
  'training_view',
  'training_add_participant',
  'training_manage_participant',
  'training_export_participants',
  // 客户管理（可以看到和管理所有客户）
  'customer_view',
  'customer_view_all',  // 查看所有客户（跨业务员）
  'customer_edit',      // 编辑客户信息
  // 业绩查看
  'salesperson_view_performance',  // 查看课程业绩
  // 专家查看
  'expert_view',
  // 招商简章
  'prospectus_view',
  'prospectus_download',
]
```

### 默认菜单配置
```typescript
// src/constants/menuFeatures.ts
conference_service: [
  'dashboard',
  'training_management',
  'customer_management',
  'sales_tracking',
  'expert_management',
  'prospectus_management',
  'profile_settings',
]
```

### 职位映射
```typescript
// src/pages/SalesPersonManagement.tsx
const positionToRole: Record<string, UserRole> = {
  '会务客服': 'conference_service',
  // ...其他职位映射
};
```

## 数据库支持

### 迁移脚本
- **文件**: `scripts/migrations/add-conference-service-role.sql`
- **功能**: 
  - 添加会务客服角色支持
  - 自动权限分配触发器
  - 默认菜单访问配置

### 执行迁移
```bash
# 在 Supabase Dashboard 的 SQL Editor 中执行
# 或使用 Supabase CLI
supabase db push
```

## 注意事项

1. **初始角色**: 新用户注册时始终为 `salesperson`，需要管理员手动改为"会务客服"
2. **权限限制**: 会务客服只能查看培训信息，不能进行任何编辑操作
3. **数据隔离**: 会务客服可以看到所有培训，不受业务员数据隔离限制
4. **角色变更**: 职位变更会自动触发权限和菜单更新，无需手动配置

## 测试验证

### 测试步骤

1. **创建测试账号**
   - 使用普通注册流程注册新账号
   - 验证初始角色为 `salesperson`

2. **变更为会务客服**
   - 管理员登录
   - 在员工管理中将职位改为"会务客服"
   - 验证角色变更为 `conference_service`

3. **验证权限**
   - 使用会务客服账号登录
   - 验证可以看到：仪表盘、培训计划、客户管理、销售追踪、专家管理、招商简章、个人设置
   - 验证可以查看和管理培训参训人员
   - 验证可以查看和编辑所有客户信息
   - 验证可以查看课程业绩
   - 验证无法添加/编辑/删除培训计划

4. **验证菜单访问**
   - 确认导航栏显示7个菜单项
   - 确认无法访问课程管理、员工管理等页面

## 常见问题

### Q: 会务客服能看到所有业务员的客户吗？
**A**: 可以。会务客服拥有 `customer_view_all` 权限，可以查看所有业务员的客户信息。

### Q: 会务客服能导出参训人员名单吗？
**A**: 可以。会务客服默认拥有 `training_export_participants` 权限，可以导出参训人员名单。

### Q: 可以批量设置会务客服角色吗？
**A**: 目前需要逐个在员工管理页面修改。如有批量需求，可以联系技术支持。

### Q: 会务客服能查看业绩数据吗？
**A**: 可以。会务客服拥有 `salesperson_view_performance` 权限，可以查看课程销售业绩和业务员排行。

## 后续优化建议

1. **批量角色变更** - 支持批量将多个员工改为会务客服
2. **权限模板** - 为会务客服创建可自定义的权限模板
3. **工作面板** - 为会务客服创建专属的工作面板
4. **通知功能** - 培训即将开始时自动通知会务客服

## 测试账号

系统已创建两个会务客服测试账号，可用于功能验证：

### 账号1: 会务客服-张小美
- **用户名**: conference_service_001
- **邮箱**: 2956734001@qq.com
- **密码**: Test123456!
- **角色**: conference_service (会务客服)
- **部门**: 会务部
- **手机**: 13800138001
- **状态**: 启用
- **权限数量**: 11个
- **可访问菜单**: 7个

### 账号2: 会务客服-李小芳
- **用户名**: conference_service_002
- **邮箱**: 2956734002@qq.com
- **密码**: Test123456!
- **角色**: conference_service (会务客服)
- **部门**: 会务部
- **手机**: 13800138002
- **状态**: 启用
- **权限数量**: 11个
- **可访问菜单**: 7个

### 测试账号权限明细

**培训管理** (4个):
- 查看培训
- 添加培训参与者
- 管理培训参与者
- 导出参训人员

**客户管理** (3个):
- 查看客户
- 查看所有客户
- 编辑客户

**其他权限** (4个):
- 查看业务员绩效
- 查看专家
- 查看简章
- 下载简章

### 登录方式

1. 访问系统登录页面
2. 使用上述邮箱和密码登录
3. 系统自动识别会务客服角色
4. 自动显示对应的菜单和权限

## 相关文档

- `docs/权限系统说明.md` - 权限系统整体说明
- `docs/角色管理说明.md` - 角色管理详细文档
- `scripts/migrations/add-conference-service-role.sql` - 数据库迁移脚本

---

**维护人员**: 开发团队  
**最后更新**: 2025-11-15  
**版本**: v1.1 (包含完整权限和测试账号)
