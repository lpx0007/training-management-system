# 折扣和优惠价功能 - 快速使用指南

## 🚀 快速开始

### 1. 执行数据库迁移

打开 Supabase SQL Editor，执行：

```sql
-- 文件：scripts/migrations/add-discount-fields-to-participants.sql
ALTER TABLE training_participants 
ADD COLUMN IF NOT EXISTS actual_price NUMERIC(10, 2);

ALTER TABLE training_participants 
ADD COLUMN IF NOT EXISTS discount_rate NUMERIC(5, 2);
```

### 2. 使用方法

#### 添加参训人时设定价格

1. **打开培训列表**
   - 点击某个培训的"添加团组/人"按钮

2. **选择客户**
   - 从客户列表中选择要添加的客户

3. **选择参与方式**
   - 线上 / 线下

4. **设置价格**（两种方式任选其一）

   **方式A：折扣率**
   ```
   1. 选择"折扣率"模式
   2. 输入折扣百分比（如：20）
   3. 看到实收价格：¥4,000
   4. 点击"确认添加"
   ```

   **方式B：优惠价**
   ```
   1. 选择"优惠价"模式
   2. 输入优惠后价格（如：4200）
   3. 看到折扣率：16% OFF
   4. 点击"确认添加"
   ```

---

## 💡 使用示例

### 场景1：促销活动（8折）

```
标准价格：¥5,000
折扣设置：选择"折扣率" → 输入 20
实收价格：¥4,000 ✅
业绩统计：按 ¥4,000 计算
```

### 场景2：团购价（直接定价）

```
标准价格：¥5,000
优惠设置：选择"优惠价" → 输入 4200
系统计算：折扣 16% OFF
业绩统计：按 ¥4,200 计算
```

### 场景3：无折扣

```
标准价格：¥5,000
折扣设置：折扣率 0% 或 不输入
实收价格：¥5,000
业绩统计：按 ¥5,000 计算
```

---

## 📊 业绩统计

### 自动计算

✅ **按实收价格计算业绩**
- 不是按标准价格
- 真实反映收入

### 示例

| 客户 | 标准价 | 折扣 | 实收价 | 业绩 |
|------|--------|------|--------|------|
| 张三 | ¥5,000 | 0% | ¥5,000 | ¥5,000 |
| 李四 | ¥5,000 | 20% | ¥4,000 | ¥4,000 |
| 王五 | ¥3,000 | 优惠价2,500 | ¥2,500 | ¥2,500 |
| **合计** | | | | **¥11,500** |

---

## ⚠️ 注意事项

1. **折扣率范围**：0-100%
2. **优惠价不能为负数**
3. **业绩立即更新**：添加后立即生效
4. **删除会扣减**：删除参训人会扣减业绩

---

## 🎯 常见问题

### Q: 如何给客户打折？
A: 添加参训人时，在价格确认对话框中输入折扣率或优惠价。

### Q: 不打折怎么设置？
A: 折扣率输入 0，或直接点确认（默认无折扣）。

### Q: 业绩怎么计算？
A: 按实收价格（优惠后的价格）计算，不是标准价格。

### Q: 可以修改已添加的参训人价格吗？
A: 当前版本暂不支持，需要删除后重新添加。

### Q: 折扣率和优惠价有什么区别？
A:
- **折扣率**：输入百分比，系统计算价格
- **优惠价**：直接输入价格，系统计算折扣率
- 效果相同，选择更方便的方式即可

---

## ✅ 快速检查

执行迁移后，检查是否成功：

```sql
-- 检查字段是否添加
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'training_participants' 
  AND column_name IN ('actual_price', 'discount_rate');
```

期望输出：
```
column_name   | data_type
--------------+-----------
actual_price  | numeric
discount_rate | numeric
```

---

**准备好了吗？执行迁移后刷新浏览器即可使用！** 🚀
