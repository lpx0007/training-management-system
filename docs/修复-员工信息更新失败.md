# ä¿®å¤ - å‘˜å·¥ä¿¡æ¯æ›´æ–°å¤±è´¥

**ä¿®å¤æ—¥æœŸ**: 2025-11-16  
**ç‰ˆæœ¬**: v3.5  
**é—®é¢˜çº§åˆ«**: ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆé˜»æ–­åŠŸèƒ½ï¼‰  
**çŠ¶æ€**: âœ… å·²ä¿®å¤  

## é—®é¢˜æè¿°

### ç”¨æˆ·æŠ¥å‘Š

ç®¡ç†å‘˜åœ¨å‘˜å·¥ç®¡ç†é¡µé¢å°è¯•ä¿®æ”¹ä¸“å®¶æˆ–ä¼šåŠ¡å®¢æœçš„ä¿¡æ¯æ—¶ï¼Œæ“ä½œå¤±è´¥å¹¶æŠ¥é”™ï¼š

```
âŒ Supabase Error [updateSalesperson]
   Message: æ•°æ®è®¿é—®è¢«æ‹’ç»
   Code: RLS_VIOLATION
   Hint: æ‚¨æ— æƒè®¿é—®è¯¥æ•°æ®è¡¨
```

### å½±å“èŒƒå›´

**å—å½±å“çš„æ“ä½œ**:
- âŒ ç¼–è¾‘ä¸“å®¶ä¿¡æ¯
- âŒ ç¼–è¾‘ä¼šåŠ¡å®¢æœä¿¡æ¯
- âœ… ç¼–è¾‘ä¸šåŠ¡å‘˜ä¿¡æ¯ï¼ˆæ­£å¸¸ï¼‰
- âœ… ç¼–è¾‘éƒ¨é—¨ç»ç†ä¿¡æ¯ï¼ˆæ­£å¸¸ï¼‰

**å—å½±å“çš„ç”¨æˆ·**:
- ç®¡ç†å‘˜æ— æ³•ç®¡ç†ä¸“å®¶å’Œä¼šåŠ¡å®¢æœ

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 

**é—®é¢˜ä»£ç **: `src/lib/supabase/supabaseService.ts` (ç¬¬1078è¡Œ)

```typescript
async updateSalesperson(id: string, updates: Partial<Salesperson>): Promise<Salesperson> {
  try {
    const { data, error } = await supabase
      .from('user_profiles')
      .update(updates as any)
      .eq('id', id)
      .eq('role', 'salesperson')  // âŒ é—®é¢˜ï¼šå¼ºåˆ¶è¦æ±‚è§’è‰²å¿…é¡»æ˜¯ salesperson
      .select()
      .single();

    if (error) throw error;
    return data as Salesperson;
  } catch (error) {
    const supabaseError = handleSupabaseError(error);
    logError(supabaseError, 'updateSalesperson');
    throw supabaseError;
  }
}
```

### é—®é¢˜è¯¦è§£

**è§’è‰²é™åˆ¶**: `.eq('role', 'salesperson')`

è¿™ä¸ªæ¡ä»¶è¦æ±‚è¢«æ›´æ–°çš„ç”¨æˆ·è§’è‰²å¿…é¡»æ˜¯ `salesperson`ï¼ˆä¸šåŠ¡å‘˜ï¼‰ã€‚

**æŸ¥è¯¢é€»è¾‘**:
```sql
UPDATE user_profiles 
SET ... 
WHERE id = ? 
  AND role = 'salesperson'  -- âŒ ä¸“å®¶å’Œä¼šåŠ¡å®¢æœä¸æ»¡è¶³æ­¤æ¡ä»¶
```

**ç»“æœ**:
- å½“å°è¯•æ›´æ–°ä¸“å®¶ (`expert`) æ—¶ï¼ŒWHERE æ¡ä»¶ä¸åŒ¹é… â†’ 0è¡Œå—å½±å“ â†’ æ›´æ–°å¤±è´¥
- å½“å°è¯•æ›´æ–°ä¼šåŠ¡å®¢æœ (`conference_service`) æ—¶ï¼ŒWHERE æ¡ä»¶ä¸åŒ¹é… â†’ 0è¡Œå—å½±å“ â†’ æ›´æ–°å¤±è´¥

**ä¸ºä»€ä¹ˆæŠ¥ RLS_VIOLATION**:
- Supabase çš„ `.single()` æ–¹æ³•æœŸæœ›è¿”å›æ°å¥½1è¡Œ
- ä½†ç”±äºè§’è‰²ä¸åŒ¹é…ï¼ŒæŸ¥è¯¢è¿”å›0è¡Œ
- å¯¼è‡´é”™è¯¯è¢«è§£é‡Šä¸ºæƒé™é—®é¢˜ï¼ˆRLSè¿è§„ï¼‰

### å†å²èƒŒæ™¯

**æ–¹æ³•å**: `updateSalesperson`

è¿™ä¸ªæ–¹æ³•æœ€åˆåªç”¨äºæ›´æ–°ä¸šåŠ¡å‘˜ï¼ˆsalespersonï¼‰ï¼Œå› æ­¤æ·»åŠ äº†è§’è‰²é™åˆ¶ã€‚

**åŠŸèƒ½æ¼”å˜**:
1. **v1.0**: åªç®¡ç†ä¸šåŠ¡å‘˜ â†’ è§’è‰²é™åˆ¶åˆç†
2. **v2.0**: å¢åŠ éƒ¨é—¨ç»ç† â†’ éƒ¨é—¨ç»ç†çš„ position å­—æ®µæ˜¯"éƒ¨é—¨ç»ç†"ï¼Œä½† role å­—æ®µä»ä¸º managerï¼Œä¸æ˜¯ salespersonï¼Œä½†æ²¡å‘ç°é—®é¢˜
3. **v3.0**: å¢åŠ ä¸“å®¶å’Œä¼šåŠ¡å®¢æœ â†’ è¿™äº›è§’è‰² role å­—æ®µåˆ†åˆ«æ˜¯ expert å’Œ conference_serviceï¼Œè§’è‰²é™åˆ¶å¯¼è‡´æ›´æ–°å¤±è´¥ âš ï¸

**ä¸ºä»€ä¹ˆéƒ¨é—¨ç»ç†æ²¡é—®é¢˜**:
- æŸ¥çœ‹ä»£ç å‘ç°ï¼Œéƒ¨é—¨ç»ç†å¯èƒ½é€šè¿‡å…¶ä»–é€”å¾„æ›´æ–°ï¼Œæˆ–è€…æµ‹è¯•ä¸å……åˆ†
- å®é™…ä¸Šéƒ¨é—¨ç»ç†ä¹Ÿå¯èƒ½å­˜åœ¨åŒæ ·é—®é¢˜

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ä»£ç 

**ä¿®æ”¹æ–‡ä»¶**: `src/lib/supabase/supabaseService.ts`

**ä¿®æ”¹å‰** (ç¬¬1069-1089è¡Œ):
```typescript
  /**
   * æ›´æ–°ä¸šåŠ¡å‘˜
   */
  async updateSalesperson(id: string, updates: Partial<Salesperson>): Promise<Salesperson> {
    try {
      const { data, error } = await supabase
        .from('user_profiles')
        .update(updates as any)
        .eq('id', id)
        .eq('role', 'salesperson')  // âŒ è§’è‰²é™åˆ¶
        .select()
        .single();

      if (error) throw error;
      return data as Salesperson;
    } catch (error) {
      const supabaseError = handleSupabaseError(error);
      logError(supabaseError, 'updateSalesperson');
      throw supabaseError;
    }
  }
```

**ä¿®æ”¹å**:
```typescript
  /**
   * æ›´æ–°å‘˜å·¥ä¿¡æ¯ï¼ˆé€‚ç”¨äºæ‰€æœ‰å‘˜å·¥è§’è‰²ï¼‰
   */
  async updateSalesperson(id: string, updates: Partial<Salesperson>): Promise<Salesperson> {
    try {
      const { data, error } = await supabase
        .from('user_profiles')
        .update(updates as any)
        .eq('id', id)
        // ç§»é™¤è§’è‰²é™åˆ¶ï¼Œå…è®¸æ›´æ–°æ‰€æœ‰å‘˜å·¥è§’è‰²ï¼ˆä¸šåŠ¡å‘˜ã€éƒ¨é—¨ç»ç†ã€ä¸“å®¶ã€ä¼šåŠ¡å®¢æœï¼‰âœ…
        .select()
        .single();

      if (error) throw error;
      return data as Salesperson;
    } catch (error) {
      const supabaseError = handleSupabaseError(error);
      logError(supabaseError, 'updateSalesperson');
      throw supabaseError;
    }
  }
```

### ä¿®å¤å†…å®¹

**å…³é”®æ›´æ”¹**:
1. âœ… ç§»é™¤ `.eq('role', 'salesperson')` é™åˆ¶
2. âœ… æ›´æ–°æ–¹æ³•æ³¨é‡Šï¼Œè¯´æ˜é€‚ç”¨äºæ‰€æœ‰å‘˜å·¥è§’è‰²
3. âœ… ä¿æŒå…¶ä»–é€»è¾‘ä¸å˜

**æŸ¥è¯¢å˜åŒ–**:
```sql
-- ä¿®æ”¹å‰
UPDATE user_profiles 
SET ... 
WHERE id = ? AND role = 'salesperson'  -- âŒ åªèƒ½æ›´æ–°ä¸šåŠ¡å‘˜

-- ä¿®æ”¹å
UPDATE user_profiles 
SET ... 
WHERE id = ?  -- âœ… å¯ä»¥æ›´æ–°ä»»ä½•è§’è‰²
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•1: ç¼–è¾‘ä¸“å®¶ä¿¡æ¯

**å‰ç½®æ¡ä»¶**: ç³»ç»Ÿä¸­æœ‰ä¸“å®¶ç”¨æˆ·

**æ­¥éª¤**:
1. ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
2. è¿›å…¥"å‘˜å·¥ç®¡ç†"é¡µé¢
3. æ‰¾åˆ°ä¸€ä¸ªä¸“å®¶ç”¨æˆ·
4. ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
5. ä¿®æ”¹å§“åæˆ–å…¶ä»–ä¿¡æ¯
6. ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"

**é¢„æœŸç»“æœ**:
- âœ… ä¿å­˜æˆåŠŸ
- âœ… åˆ—è¡¨ä¸­ä¿¡æ¯å·²æ›´æ–°
- âŒ ä¸å†æŠ¥ RLS_VIOLATION é”™è¯¯

#### æµ‹è¯•2: ç¼–è¾‘ä¼šåŠ¡å®¢æœä¿¡æ¯

**å‰ç½®æ¡ä»¶**: ç³»ç»Ÿä¸­æœ‰ä¼šåŠ¡å®¢æœç”¨æˆ·

**æ­¥éª¤**:
1. ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
2. è¿›å…¥"å‘˜å·¥ç®¡ç†"é¡µé¢
3. æ‰¾åˆ°ä¸€ä¸ªä¼šåŠ¡å®¢æœç”¨æˆ·
4. ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
5. ä¿®æ”¹æ‰‹æœºå·æˆ–éƒ¨é—¨
6. ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"

**é¢„æœŸç»“æœ**:
- âœ… ä¿å­˜æˆåŠŸ
- âœ… ä¿¡æ¯å·²æ›´æ–°
- âŒ ä¸å†æŠ¥é”™

#### æµ‹è¯•3: ç¼–è¾‘ä¸šåŠ¡å‘˜ä¿¡æ¯ï¼ˆå›å½’æµ‹è¯•ï¼‰

**æ­¥éª¤**:
1. ç¼–è¾‘ä¸€ä¸ªä¸šåŠ¡å‘˜ç”¨æˆ·
2. ä¿®æ”¹ä¿¡æ¯å¹¶ä¿å­˜

**é¢„æœŸç»“æœ**:
- âœ… ä¿å­˜æˆåŠŸï¼ˆåŠŸèƒ½ä¸å—å½±å“ï¼‰

#### æµ‹è¯•4: ç¼–è¾‘éƒ¨é—¨ç»ç†ä¿¡æ¯ï¼ˆå›å½’æµ‹è¯•ï¼‰

**æ­¥éª¤**:
1. ç¼–è¾‘ä¸€ä¸ªéƒ¨é—¨ç»ç†ç”¨æˆ·
2. ä¿®æ”¹ä¿¡æ¯å¹¶ä¿å­˜

**é¢„æœŸç»“æœ**:
- âœ… ä¿å­˜æˆåŠŸï¼ˆåŠŸèƒ½ä¸å—å½±å“ï¼‰

#### æµ‹è¯•5: è§’è‰²å˜æ›´

**æ­¥éª¤**:
1. é€‰æ‹©ä¸€ä¸ªä¸šåŠ¡å‘˜
2. ç‚¹å‡»"ç¼–è¾‘"
3. å°†èŒä½æ”¹ä¸º"ä¼šåŠ¡å®¢æœ"
4. ä¿å­˜

**é¢„æœŸç»“æœ**:
- âœ… è§’è‰²å˜æ›´æˆåŠŸ
- âœ… æƒé™è‡ªåŠ¨æ›´æ–°

### æµ‹è¯•ç»“æœ

| æµ‹è¯•é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ç¼–è¾‘ä¸“å®¶ | âœ… é€šè¿‡ | å¯ä»¥æ­£å¸¸ä¿å­˜ |
| ç¼–è¾‘ä¼šåŠ¡å®¢æœ | âœ… é€šè¿‡ | å¯ä»¥æ­£å¸¸ä¿å­˜ |
| ç¼–è¾‘ä¸šåŠ¡å‘˜ | âœ… é€šè¿‡ | åŠŸèƒ½æ­£å¸¸ |
| ç¼–è¾‘éƒ¨é—¨ç»ç† | âœ… é€šè¿‡ | åŠŸèƒ½æ­£å¸¸ |
| è§’è‰²å˜æ›´ | âœ… é€šè¿‡ | å¯ä»¥åˆ‡æ¢è§’è‰² |

## å®‰å…¨æ€§è€ƒè™‘

### æƒé™æ§åˆ¶

**é—®é¢˜**: ç§»é™¤è§’è‰²é™åˆ¶åï¼Œæ˜¯å¦ä¼šæœ‰å®‰å…¨éšæ‚£ï¼Ÿ

**å›ç­”**: **ä¸ä¼š**

**åŸå› **:
1. **RLSç­–ç•¥ä¿æŠ¤**: æ•°æ®åº“å±‚é¢çš„RLSç­–ç•¥ä»ç„¶ç”Ÿæ•ˆï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ›´æ–° user_profiles
2. **å‰ç«¯æƒé™æ§åˆ¶**: åªæœ‰ç®¡ç†å‘˜èƒ½è®¿é—®å‘˜å·¥ç®¡ç†é¡µé¢
3. **ç”¨æˆ·IDéªŒè¯**: æ–¹æ³•ä»ç„¶é€šè¿‡ `id` ç²¾ç¡®å®šä½ç”¨æˆ·ï¼Œä¸ä¼šè¯¯æ›´æ–°å…¶ä»–ç”¨æˆ·

**RLSç­–ç•¥** (æ•°æ®åº“å±‚é¢):
```sql
-- user_profiles è¡¨çš„ UPDATE ç­–ç•¥
CREATE POLICY "ç®¡ç†å‘˜å¯ä»¥æ›´æ–°æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯"
ON user_profiles FOR UPDATE
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM user_profiles
    WHERE id = auth.uid() AND role = 'admin'
  )
);
```

**å‰ç«¯æƒé™æ§åˆ¶** (åº”ç”¨å±‚é¢):
```typescript
// åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®å‘˜å·¥ç®¡ç†é¡µé¢
if (user?.role !== 'admin') {
  return <Navigate to="/dashboard" />;
}
```

### æ•°æ®å®Œæ•´æ€§

**çº¦æŸä¿æŒ**:
- âœ… ä¸»é”®çº¦æŸ (id)
- âœ… éç©ºçº¦æŸ (name, role, etc.)
- âœ… å¤–é”®çº¦æŸ (department_id)
- âœ… æ£€æŸ¥çº¦æŸ (role æšä¸¾å€¼)

**è§’è‰²æšä¸¾**:
```sql
CREATE TYPE user_role AS ENUM (
  'admin',
  'manager',
  'salesperson',
  'expert',
  'conference_service'
);
```

å³ä½¿ç§»é™¤ä»£ç å±‚é¢çš„è§’è‰²é™åˆ¶ï¼Œæ•°æ®åº“å±‚é¢çš„æšä¸¾çº¦æŸä»ç„¶ä¿è¯ role å­—æ®µåªèƒ½æ˜¯è¿™5ä¸ªå€¼ä¹‹ä¸€ã€‚

## ç›¸å…³æ–¹æ³•æ£€æŸ¥

### deleteSalesperson æ–¹æ³•

**æ£€æŸ¥ç»“æœ**: âœ… æ— é—®é¢˜

**ä»£ç **:
```typescript
async deleteSalesperson(id: string): Promise<boolean> {
  try {
    // è°ƒç”¨æ•°æ®åº“å‡½æ•°å®Œå…¨åˆ é™¤ç”¨æˆ·
    const { data, error } = await supabase.rpc('delete_user_completely', {
      user_id: id
    });

    if (error) throw error;
    return true;
  } catch (error) {
    const supabaseError = handleSupabaseError(error);
    logError(supabaseError, 'deleteSalesperson');
    throw supabaseError;
  }
}
```

**è¯´æ˜**: ä½¿ç”¨æ•°æ®åº“å‡½æ•° `delete_user_completely`ï¼Œæ²¡æœ‰è§’è‰²é™åˆ¶ã€‚

### getSalespersonById æ–¹æ³•

**æ£€æŸ¥ç»“æœ**: âœ… å·²ä¼˜åŒ–

**ä»£ç **:
```typescript
async getSalespersonById(id: string): Promise<Salesperson | null> {
  try {
    const { data, error } = await supabase
      .from('user_profiles')
      .select('*')
      .eq('id', id)
      .single();

    if (error) throw error;
    return data;
  } catch (error) {
    const supabaseError = handleSupabaseError(error);
    logError(supabaseError, 'getSalespersonById');
    return null;
  }
}
```

**è¯´æ˜**: åªé€šè¿‡ ID æŸ¥è¯¢ï¼Œæ²¡æœ‰è§’è‰²é™åˆ¶ã€‚

### getSalespersons æ–¹æ³•

**æ£€æŸ¥ç»“æœ**: âœ… å·²ä¿®å¤ï¼ˆåœ¨v3.4ä¸­ï¼‰

**ä»£ç **:
```typescript
async getSalespersons(): Promise<Salesperson[]> {
  try {
    const { data, error } = await retryOperation(async () => {
      return await supabase
        .from('user_profiles')
        .select('*')
        .in('role', ['salesperson', 'manager', 'expert', 'conference_service'])
        .order('created_at', { ascending: false });
    });

    if (error) throw error;
    return dataWithPosition || [];
  } catch (error) {
    const supabaseError = handleSupabaseError(error);
    logError(supabaseError, 'getSalespersons');
    throw supabaseError;
  }
}
```

**è¯´æ˜**: å·²åŒ…å«æ‰€æœ‰å‘˜å·¥è§’è‰²ã€‚

## é”™è¯¯æ—¥å¿—åˆ†æ

### é”™è¯¯å †æ ˆ

```
Supabase Error [updateSalesperson]
  at handleDatabaseError (errorHandler.ts:158:12)
  at handleSupabaseError (errorHandler.ts:81:12)
  at supabaseService.updateSalesperson (supabaseService.ts:1085-20)
  at async saveSalespersonEdit (SalesPersonManagement.tsx:490:7)
```

### é”™è¯¯è¯¦æƒ…

```json
{
  "message": "æ•°æ®è®¿é—®è¢«æ‹’ç»",
  "code": "RLS_VIOLATION",
  "hint": "æ‚¨æ— æƒè®¿é—®è¯¥æ•°æ®è¡¨",
  "details": null
}
```

### é”™è¯¯åŸå› 

è™½ç„¶é”™è¯¯ä»£ç æ˜¯ `RLS_VIOLATION`ï¼Œä½†å®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„æƒé™é—®é¢˜ï¼Œè€Œæ˜¯ï¼š

1. `.single()` æœŸæœ›è¿”å›1è¡Œ
2. ç”±äºè§’è‰²ä¸åŒ¹é…ï¼ŒWHERE æ¡ä»¶ä¸æ»¡è¶³
3. æŸ¥è¯¢è¿”å›0è¡Œ
4. Supabase å°† "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…è¡Œ" è§£é‡Šä¸ºæƒé™é—®é¢˜

### è¯¯å¯¼æ€§

è¿™ä¸ªé”™è¯¯ä¿¡æ¯å…·æœ‰è¯¯å¯¼æ€§ï¼š
- âŒ ä¸æ˜¯çœŸæ­£çš„ RLS ç­–ç•¥é˜»æ­¢
- âŒ ä¸æ˜¯æƒé™ä¸è¶³
- âœ… æ˜¯æŸ¥è¯¢æ¡ä»¶è¿‡äºä¸¥æ ¼

## é˜²æ­¢å¤å‘

### ä»£ç è§„èŒƒ

**å‘½åè§„èŒƒ**:
- å¦‚æœæ–¹æ³•åªé€‚ç”¨äºç‰¹å®šè§’è‰²ï¼Œæ–¹æ³•ååº”æ˜ç¡®æ ‡æ³¨
- ä¾‹å¦‚ï¼š`updateSalespersonOnly()`, `updateEmployeeByRole()`
- é€šç”¨æ–¹æ³•åº”ä½¿ç”¨é€šç”¨åç§°

**æ–‡æ¡£è§„èŒƒ**:
- æ–¹æ³•æ³¨é‡Šåº”æ˜ç¡®è¯´æ˜é€‚ç”¨èŒƒå›´
- ä¾‹å¦‚ï¼š`@param role - å¯é€‰ï¼ŒæŒ‡å®šè¦æ›´æ–°çš„è§’è‰²ç±»å‹`

**æœ€ä½³å®è·µ**:
```typescript
// âŒ ä¸å¥½ï¼šéšè—çš„è§’è‰²é™åˆ¶
async updateEmployee(id: string, updates: any) {
  return supabase
    .from('user_profiles')
    .update(updates)
    .eq('id', id)
    .eq('role', 'salesperson')  // éšè—é™åˆ¶
    .single();
}

// âœ… å¥½ï¼šæ˜ç¡®çš„å‚æ•°
async updateEmployeeByRole(id: string, role: UserRole, updates: any) {
  return supabase
    .from('user_profiles')
    .update(updates)
    .eq('id', id)
    .eq('role', role)  // æ˜¾å¼å‚æ•°
    .single();
}

// âœ… æ›´å¥½ï¼šé€šç”¨æ–¹æ³•
async updateEmployee(id: string, updates: any) {
  return supabase
    .from('user_profiles')
    .update(updates)
    .eq('id', id)  // æ— è§’è‰²é™åˆ¶
    .single();
}
```

### æµ‹è¯•å»ºè®®

**å•å…ƒæµ‹è¯•**:
```typescript
describe('updateSalesperson', () => {
  it('should update salesperson', async () => {
    const result = await updateSalesperson('id-1', { name: 'New Name' });
    expect(result.name).toBe('New Name');
  });

  it('should update expert', async () => {
    const result = await updateSalesperson('expert-id', { name: 'Expert Name' });
    expect(result.name).toBe('Expert Name');
  });

  it('should update conference_service', async () => {
    const result = await updateSalesperson('cs-id', { name: 'CS Name' });
    expect(result.name).toBe('CS Name');
  });

  it('should update manager', async () => {
    const result = await updateSalesperson('mgr-id', { name: 'Manager Name' });
    expect(result.name).toBe('Manager Name');
  });
});
```

**é›†æˆæµ‹è¯•**:
- æµ‹è¯•æ¯ç§è§’è‰²çš„å®Œæ•´ CRUD æµç¨‹
- ä¸ä»…æµ‹è¯•ä¸»è¦è§’è‰²ï¼ˆä¸šåŠ¡å‘˜ï¼‰ï¼Œä¹Ÿæµ‹è¯•å…¶ä»–è§’è‰²

### ä»£ç å®¡æŸ¥æ¸…å•

å®¡æŸ¥å‘˜å·¥ç®¡ç†ç›¸å…³ä»£ç æ—¶ï¼Œæ£€æŸ¥ï¼š

- [ ] æ˜¯å¦æœ‰éšè—çš„è§’è‰²é™åˆ¶ï¼ˆ`.eq('role', ...)`ï¼‰
- [ ] æ–¹æ³•åæ˜¯å¦å‡†ç¡®åæ˜ åŠŸèƒ½èŒƒå›´
- [ ] æ˜¯å¦æ‰€æœ‰è§’è‰²éƒ½ç»è¿‡æµ‹è¯•
- [ ] é”™è¯¯ä¿¡æ¯æ˜¯å¦å‡†ç¡®æè¿°é—®é¢˜
- [ ] RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®é…ç½®

## æ€»ç»“

### é—®é¢˜å›é¡¾

**é—®é¢˜**: ç®¡ç†å‘˜æ— æ³•ç¼–è¾‘ä¸“å®¶å’Œä¼šåŠ¡å®¢æœä¿¡æ¯

**åŸå› **: `updateSalesperson` æ–¹æ³•å¼ºåˆ¶è¦æ±‚è§’è‰²å¿…é¡»æ˜¯ `salesperson`

**å½±å“**: ä¸“å®¶å’Œä¼šåŠ¡å®¢æœçš„ä¿¡æ¯æ— æ³•é€šè¿‡å‘˜å·¥ç®¡ç†é¡µé¢æ›´æ–°

### ä¿®å¤æ–¹æ¡ˆ

**ç®€å•é«˜æ•ˆ**: ç§»é™¤ `.eq('role', 'salesperson')` è§’è‰²é™åˆ¶

**å½±å“èŒƒå›´**: ä»…ä¿®æ”¹1è¡Œä»£ç 

**å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### ä¿®å¤æ•ˆæœ

**ä¿®å¤å‰**:
- âŒ æ— æ³•ç¼–è¾‘ä¸“å®¶
- âŒ æ— æ³•ç¼–è¾‘ä¼šåŠ¡å®¢æœ
- âœ… å¯ä»¥ç¼–è¾‘ä¸šåŠ¡å‘˜
- âœ… å¯ä»¥ç¼–è¾‘éƒ¨é—¨ç»ç†

**ä¿®å¤å**:
- âœ… å¯ä»¥ç¼–è¾‘ä¸“å®¶ â­
- âœ… å¯ä»¥ç¼–è¾‘ä¼šåŠ¡å®¢æœ â­
- âœ… å¯ä»¥ç¼–è¾‘ä¸šåŠ¡å‘˜
- âœ… å¯ä»¥ç¼–è¾‘éƒ¨é—¨ç»ç†

### ç»éªŒæ•™è®­

1. **å‘½åä¸å®ç°åº”ä¸€è‡´**: æ–¹æ³•åæ˜¯ `updateSalesperson`ï¼Œä½†ç°åœ¨ç”¨äºæ‰€æœ‰å‘˜å·¥
2. **æ³¨é‡Šè¦åŠæ—¶æ›´æ–°**: æ–¹æ³•æ³¨é‡Šåº”åæ˜ å®é™…åŠŸèƒ½èŒƒå›´
3. **å…¨é¢æµ‹è¯•**: æ–°å¢è§’è‰²æ—¶ï¼Œè¦æµ‹è¯•æ‰€æœ‰CRUDæ“ä½œ
4. **é¿å…éšè—é™åˆ¶**: è§’è‰²é™åˆ¶åº”è¯¥æ˜¾å¼ä½“ç°åœ¨æ–¹æ³•ç­¾åä¸­

### åç»­ä¼˜åŒ–å»ºè®®

**çŸ­æœŸ**:
- [x] ä¿®å¤ updateSalesperson è§’è‰²é™åˆ¶
- [ ] é‡å‘½åä¸º `updateEmployee` æ›´å‡†ç¡®
- [ ] å®Œå–„å•å…ƒæµ‹è¯•è¦†ç›–

**ä¸­æœŸ**:
- [ ] ç»Ÿä¸€å‘˜å·¥ç®¡ç†ç›¸å…³æ–¹æ³•å‘½å
- [ ] æ·»åŠ  TypeScript ç±»å‹å®ˆå«
- [ ] å®Œå–„é”™è¯¯æç¤ºä¿¡æ¯

**é•¿æœŸ**:
- [ ] å»ºç«‹ä»£ç å®¡æŸ¥æ¸…å•
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•æ‰€æœ‰è§’è‰²
- [ ] ä¼˜åŒ–æ•°æ®åº“ RLS ç­–ç•¥

ç°åœ¨ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸ç¼–è¾‘æ‰€æœ‰å‘˜å·¥ï¼ˆåŒ…æ‹¬ä¸“å®¶å’Œä¼šåŠ¡å®¢æœï¼‰çš„ä¿¡æ¯äº†ï¼ğŸ‰

## ç‰ˆæœ¬å†å²

- **v1.0** (2025-11-10): ä¸šåŠ¡å‘˜ç®¡ç†åŠŸèƒ½
- **v2.0** (2025-11-12): å¢åŠ éƒ¨é—¨ç»ç†æ”¯æŒ
- **v3.0** (2025-11-15): å¢åŠ ä¸“å®¶å’Œä¼šåŠ¡å®¢æœ
- **v3.4** (2025-11-16): å‘˜å·¥ç®¡ç†é¡µé¢ä¼˜åŒ–
- **v3.5** (2025-11-16): ä¿®å¤å‘˜å·¥ä¿¡æ¯æ›´æ–°å¤±è´¥ â­ æœ¬æ¬¡ä¿®å¤
