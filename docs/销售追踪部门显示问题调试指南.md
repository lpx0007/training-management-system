# 销售追踪部门显示问题调试指南

## 问题描述
部门经理登录后，销售追踪页面所有业务员的部门都显示为"未分配部门"。

## 调试步骤

### 1. 确认数据库数据
```sql
-- 检查业务员的部门分配
SELECT 
  up.id,
  up.name,
  up.department_id,
  d.name as department_name
FROM user_profiles up
LEFT JOIN departments d ON up.department_id = d.id
WHERE up.role = 'salesperson';
```
✅ 数据库中业务员都有正确的department_id

### 2. 检查团队成员关系
```sql
-- 检查team_members表
SELECT 
  d.name as department,
  m.name as manager_name,
  s.name as salesperson_name
FROM team_members tm
JOIN user_profiles m ON tm.manager_id = m.id
JOIN user_profiles s ON tm.member_id = s.id
JOIN departments d ON tm.department_id = d.id
WHERE tm.status = 'active';
```
✅ team_members关系已正确建立

### 3. 开启控制台调试

我已经在 `salespersonService.ts` 中添加了调试日志。

**请按以下步骤操作**：

1. **打开浏览器开发者工具**（F12）
2. **切换到Console（控制台）标签**
3. **清空控制台**（右键 -> Clear Console）
4. **刷新页面**（F5）
5. **查看控制台输出**

### 4. 预期看到的日志

```
📋 获取到的部门ID列表: [1, 2, 3]
📋 查询到的部门信息: [{id: 1, name: "销售一部"}, ...]
  部门映射: 1 -> 销售一部
  部门映射: 2 -> 销售二部
  部门映射: 3 -> 销售三部
  业务员 小周 (ID:xxx, dept_id:1) -> 部门:销售一部
  ...
📋 最终返回的业务员列表: [...]
```

### 5. 可能的问题

#### 问题1：部门ID类型不匹配
如果日志显示 dept_id 为字符串但 Map 的 key 是数字，会导致匹配失败。

#### 问题2：departments表查询失败
如果看到"获取部门信息失败"的错误，说明查询departments表时出错。

#### 问题3：用户未重新登录
部门经理必须**重新登录**才能加载department_id。

### 6. 快速修复尝试

如果控制台显示类型不匹配问题，请告诉我具体的日志内容，我将进行修复。

### 7. 验证用户状态

在控制台输入以下命令，查看当前用户信息：
```javascript
// 查看当前用户
JSON.parse(localStorage.getItem('sb-qinpsvempgjjocjfjvpc-auth-token'))
```

## 需要提供的信息

请提供：
1. 控制台中的调试日志（特别是📋开头的日志）
2. 是否有任何错误信息
3. 当前登录的是哪个部门经理账号
